# Level 4: Context Managers

[concept]
id = "context_managers"
name = "Context Managers: Auto-Cleanup"
level = 4
category = "resource_management"
order = 5

[content]
lesson = """
## Never Forget to Clean Up

Context managers ensure resources are properly released:

```python
with open('save.json', 'w') as f:
    f.write(data)
# File automatically closed, even if error occurs!
```

## The `with` Statement

```python
# Good - auto-closes
with open('file.txt', 'r') as f:
    data = f.read()
# File is closed here

# Bad - might not close on error
f = open('file.txt', 'r')
data = f.read()
f.close()  # Easy to forget!
```

## Multiple Resources

```python
with open('input.txt') as f_in, open('output.txt', 'w') as f_out:
    data = f_in.read()
    f_out.write(data.upper())
# Both files closed automatically
```

## Create Your Own

Using `@contextmanager` decorator:

```python
from contextlib import contextmanager
import time

@contextmanager
def timer(name):
    start = time.time()
    print(f"Starting {name}...")
    try:
        yield
    finally:
        elapsed = time.time() - start
        print(f"{name} took {elapsed:.4f}s")

with timer("world generation"):
    # Generate world
    time.sleep(0.1)
# Output:
# Starting world generation...
# world generation took 0.1002s
```

## Class-Based Context Manager

```python
class FileLogger:
    def __init__(self, filename):
        self.filename = filename
        self.file = None

    def __enter__(self):
        self.file = open(self.filename, 'a')
        return self.file

    def __exit__(self, exc_type, exc_val, exc_tb):
        if self.file:
            self.file.close()
        return False  # Don't suppress exceptions

with FileLogger('game.log') as log:
    log.write('Event logged\\n')
```

## Common Uses

- File handling
- Database connections
- Thread locks
- Temporary settings changes
- Transaction rollback on error
"""

[content.try_it]
prompt = "Use a context manager to safely write to a file"
starter = '''
# Write "Hello, World!" to hello.txt using 'with'

'''
solution = '''
with open('hello.txt', 'w') as f:
    f.write("Hello, World!")
# File automatically closed
'''

[connections]
prerequisites = ["file_io", "exceptions"]
enables = []
used_in = []
see_also = ["file_io", "decorators"]

[meta]
time_to_read = 55
difficulty = "intermediate"
tags = ["context_managers", "with", "resources"]
