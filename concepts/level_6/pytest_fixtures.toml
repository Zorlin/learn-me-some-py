# Level 6: Pytest Fixtures

[concept]
id = "pytest_fixtures"
name = "Fixtures: Reusable Test Setup"
level = 6
category = "testing"
order = 1

[content]
lesson = """
## Automatic Test Setup

Fixtures provide test data and handle setup/cleanup:

```python
import pytest

@pytest.fixture
def game_character():
    return Character(name="Hero", hp=100)

def test_takes_damage(game_character):
    game_character.take_damage(20)
    assert game_character.hp == 80

def test_levels_up(game_character):
    game_character.gain_xp(1000)
    assert game_character.level == 2

# Each test gets a FRESH character!
```

## Cleanup with yield

```python
@pytest.fixture
def database():
    # Setup
    db = Database("test.db")
    db.connect()

    yield db  # Test runs here

    # Cleanup (always runs)
    db.disconnect()
    db.delete()
```

## Fixture Scope

```python
@pytest.fixture(scope="function")  # Default - new each test
def fresh_data():
    return []

@pytest.fixture(scope="module")  # Shared in file
def expensive_data():
    return load_big_file()

@pytest.fixture(scope="session")  # Shared globally
def database_connection():
    return connect_to_db()
```

## Fixture Dependencies

```python
@pytest.fixture
def database():
    return Database()

@pytest.fixture
def user(database):  # Uses database fixture!
    return database.create_user("alice")

def test_user_name(user):
    assert user.name == "alice"
```

## conftest.py: Share Fixtures

```
tests/
├── conftest.py      # Fixtures available to ALL tests
├── test_user.py
└── test_game.py
```

```python
# conftest.py
@pytest.fixture
def app():
    return create_app()
```

## Built-in Fixtures

```python
def test_file_write(tmp_path):
    # tmp_path is a built-in fixture!
    file = tmp_path / "test.txt"
    file.write_text("hello")
    assert file.read_text() == "hello"
```

Built-in fixtures:
- `tmp_path` - Temporary directory
- `capsys` - Capture stdout/stderr
- `monkeypatch` - Modify objects temporarily
"""

[content.try_it]
prompt = "Create a fixture that provides a list of sample users"
starter = '''
import pytest

# Create a fixture called 'sample_users'

def test_user_count(sample_users):
    assert len(sample_users) == 3
'''
solution = '''
import pytest

@pytest.fixture
def sample_users():
    return [
        {"name": "Alice", "age": 30},
        {"name": "Bob", "age": 25},
        {"name": "Charlie", "age": 35},
    ]

def test_user_count(sample_users):
    assert len(sample_users) == 3
'''

[connections]
prerequisites = ["pytest_basics", "decorators", "generators"]
enables = []
used_in = []
see_also = ["pytest_basics"]

[meta]
time_to_read = 55
difficulty = "expert"
tags = ["pytest", "fixtures", "testing"]
