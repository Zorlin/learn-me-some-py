import{d as ue,u as re,r as v,a as de,c as _,A as ve,x as pe,o as me,b as a,g as s,h as S,j as _e,f as i,t as c,e as fe,p as X,F as w,i as L,q as xe,s as he,k as o,_ as be}from"./index-B7Pz_r6u.js";import{d as B,C as ge,T as ye}from"./TestResults-Dz9-xahR.js";import{b as M}from"./client-H5C7n97n.js";const ke={class:"max-w-6xl mx-auto px-4 py-8"},Ce={key:0,class:"text-center py-12 text-text-muted"},we={key:1,class:"text-center py-12"},Le={key:2,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},He={class:"lg:col-span-1"},Te={class:"oled-panel sticky top-20"},Re={class:"flex items-center gap-2 mb-2"},$e={class:"level-badge"},Se={class:"category-tag"},Be={key:0,class:"bonus-badge"},Me={class:"text-2xl font-bold mb-2"},je={class:"text-text-secondary mb-4"},Ne={key:0,class:"border-t border-oled-border pt-4 mt-4"},Ue={key:1,class:"mt-4 p-3 bg-accent-warning/10 border border-accent-warning/30 rounded-lg"},Ve={class:"flex items-center justify-between mb-1"},Ae={key:0,class:"flex items-center gap-1"},Ie=["disabled"],qe={class:"text-xs text-text-muted"},Ee=["disabled"],Fe=["innerHTML"],Ye={class:"flex flex-col gap-2 mt-4"},De=["disabled"],Ge={key:2,class:"mt-6 pt-4 border-t border-oled-border"},Oe={class:"flex flex-wrap gap-1"},Pe=["onClick"],Xe={key:3,class:"mt-4"},ze={key:0,class:"mb-3"},Je={class:"flex flex-wrap gap-1"},We=["onClick"],Ke={key:1},Qe={class:"flex flex-wrap gap-1"},Ze=["onClick"],et={key:4,class:"mt-4 pt-4 border-t border-oled-border"},tt=["innerHTML"],st={class:"lg:col-span-2 space-y-6"},nt={key:0},ot={key:1,class:"oled-panel text-center py-8"},at={key:2,class:"oled-panel"},lt={class:"flex items-center gap-2"},it={class:"text-xs text-text-muted"},ct={class:"text-text-muted"},ut={key:0,class:"mt-4 pt-4 border-t border-oled-border"},rt=["innerHTML"],dt={key:3,class:"oled-panel"},vt={class:"flex flex-wrap gap-2"},pt=["onClick"],z=3,mt=ue({__name:"ConceptLessonView",setup(_t){const J=ve(),f=_e(),j=re(),t=v(null),H=v(!0),p=v(""),N=v(!1),x=v(0),d=v([]),r=v(0),h=v(!1),m=v(null),g=v(!0);de({onBack:()=>f.push("/concepts")});const T=_(()=>J.params.id),W=_(()=>{var n;return(n=t.value)!=null&&n.try_it?p.value!==t.value.try_it.starter:!1});pe(()=>j.buttons,n=>{t.value&&(n.X&&t.value.try_it&&V(),n.Y&&t.value.try_it&&U())},{deep:!0}),me(async()=>{await K()});async function K(){var n;H.value=!0;try{const e=await M.get(T.value);e.ok&&(t.value=e.data,(n=t.value)!=null&&n.try_it&&(p.value=t.value.try_it.starter),await M.markSeen(T.value))}catch(e){console.error("Failed to load lesson:",e)}H.value=!1}function U(){if(x.value<z){x.value++;const n=Q(x.value);n&&!d.value.includes(n)&&(d.value.push(n),r.value=d.value.length-1),N.value=!0}}function Q(n){var b;if(!((b=t.value)!=null&&b.try_it))return null;const e=t.value.try_it.solution,u=e.split(`
`).filter(C=>C.trim());switch(n){case 1:return"Look at the examples in the lesson. What pattern do you see?";case 2:return u.length>0?`Start with:
\`\`\`python
${u[0]}
\`\`\``:"Review the code examples and apply the same pattern.";case 3:return`**Solution:**
\`\`\`python
${e}\`\`\``;default:return null}}const y=_(()=>d.value.length===0?null:d.value[r.value]??null),Z=_(()=>{if(!y.value)return"";try{return B(y.value)}catch{return y.value}});function ee(){r.value>0&&r.value--}function te(){r.value<d.value.length-1&&r.value++}async function V(){var n;if((n=t.value)!=null&&n.try_it){h.value=!0,m.value=null;try{const u=await(await fetch("/api/code/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lesson_id:t.value.id,code:p.value})})).json();m.value={success:u.success,passing:u.tests_passing,total:u.tests_total,output:u.output||"",error:u.error,test_results:u.test_results}}catch(e){m.value={success:!1,passing:0,total:1,output:"",error:String(e)}}h.value=!1}}function se(){var n;(n=t.value)!=null&&n.try_it&&(p.value=t.value.try_it.starter,m.value=null)}function ne(){M.markUnderstood(T.value),f.push("/concepts")}function R(n){f.push(`/concept/${n}`)}function oe(n){f.push(`/challenge/${n}`)}function ae(n){return n.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function k(n){return n.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const le=_(()=>{var n;if(!((n=t.value)!=null&&n.description_detailed))return"";try{return B(t.value.description_detailed)}catch{return`<pre>${t.value.description_detailed}</pre>`}}),ie=_(()=>{var n;if(!((n=t.value)!=null&&n.lesson))return"";try{return B(t.value.lesson)}catch{return`<pre>${t.value.lesson}</pre>`}}),ce=_(()=>{var n;if(t.value)return{name:`Concept: ${t.value.name}`,description:((n=t.value.try_it)==null?void 0:n.prompt)||"Read the lesson content and apply the concepts.",code:p.value}});return(n,e)=>{var u,b,C,A,I,q,E,F,Y,D,G,O,P;return o(),a("div",ke,[H.value?(o(),a("div",Ce," Loading lesson... ")):t.value?(o(),a("div",Le,[s("div",He,[s("div",Te,[s("div",Re,[s("div",$e,"Level "+c(t.value.level),1),s("span",Se,c(ae(t.value.category)),1),t.value.bonus?(o(),a("span",Be,"‚≠ê Bonus")):i("",!0)]),s("h1",Me,c(t.value.name),1),s("p",je,c(t.value.description_brief||"Learn this concept and practice it."),1),S(j).connected?(o(),a("div",Ne,[...e[6]||(e[6]=[fe('<div class="text-sm text-text-muted mb-2" data-v-c9c4f37f>Controls</div><div class="grid grid-cols-2 gap-2 text-sm" data-v-c9c4f37f><div data-v-c9c4f37f><span class="gamepad-button" data-v-c9c4f37f>X</span> Run Tests</div><div data-v-c9c4f37f><span class="gamepad-button" data-v-c9c4f37f>Y</span> Hint</div><div data-v-c9c4f37f><span class="gamepad-button" data-v-c9c4f37f>B</span> Back</div></div>',2)])])):i("",!0),N.value&&y.value?(o(),a("div",Ue,[s("div",Ve,[e[7]||(e[7]=s("div",{class:"text-sm text-accent-warning font-medium"},"üí° Hint",-1)),d.value.length>1?(o(),a("div",Ae,[s("button",{class:X(["hint-nav-btn",{"opacity-30":r.value===0}]),disabled:r.value===0,onClick:ee},"‚Äπ",10,Ie),s("span",qe,c(r.value+1)+"/"+c(d.value.length),1),s("button",{class:X(["hint-nav-btn",{"opacity-30":r.value===d.value.length-1}]),disabled:r.value===d.value.length-1,onClick:te},"‚Ä∫",10,Ee)])):i("",!0)]),s("div",{class:"prose prose-invert prose-sm hint-content",innerHTML:Z.value},null,8,Fe)])):i("",!0),s("div",Ye,[(u=m.value)!=null&&u.success?(o(),a("button",{key:0,class:"oled-button-success gamepad-focusable animate-pulse",onClick:ne}," ‚úÖ Complete Lesson ")):i("",!0),t.value.try_it?(o(),a("button",{key:1,class:"oled-button-primary gamepad-focusable",disabled:h.value,onClick:V},c(h.value?"‚è≥ Running...":"‚ñ∂ Run Tests"),9,De)):i("",!0),t.value.try_it&&x.value<z?(o(),a("button",{key:2,class:"oled-button gamepad-focusable",onClick:U}," üí° "+c(x.value===0?"Need a hint?":x.value===2?"Show solution":"Another hint"),1)):i("",!0),W.value?(o(),a("button",{key:3,class:"oled-button text-accent-warning gamepad-focusable",onClick:se}," üîÑ Reset to Start ")):i("",!0),s("button",{class:"oled-button gamepad-focusable",onClick:e[1]||(e[1]=l=>S(f).push("/concepts"))}," ‚Üê Back to Concepts ")]),(C=(b=t.value.connections)==null?void 0:b.prerequisites)!=null&&C.length?(o(),a("div",Ge,[e[8]||(e[8]=s("div",{class:"text-xs text-text-muted mb-2"},"üìã Prerequisites",-1)),s("div",Oe,[(o(!0),a(w,null,L(t.value.connections.prerequisites,l=>(o(),a("button",{key:l,class:"connection-chip prereq gamepad-focusable",onClick:$=>R(l)},c(k(l)),9,Pe))),128))])])):i("",!0),(I=(A=t.value.connections)==null?void 0:A.enables)!=null&&I.length||(E=(q=t.value.connections)==null?void 0:q.used_in)!=null&&E.length?(o(),a("div",Xe,[(Y=(F=t.value.connections)==null?void 0:F.enables)!=null&&Y.length?(o(),a("div",ze,[e[9]||(e[9]=s("div",{class:"text-xs text-text-muted mb-1"},"‚û°Ô∏è Unlocks",-1)),s("div",Je,[(o(!0),a(w,null,L(t.value.connections.enables,l=>(o(),a("button",{key:l,class:"connection-chip enables gamepad-focusable",onClick:$=>R(l)},c(k(l)),9,We))),128))])])):i("",!0),(G=(D=t.value.connections)==null?void 0:D.used_in)!=null&&G.length?(o(),a("div",Ke,[e[10]||(e[10]=s("div",{class:"text-xs text-text-muted mb-1"},"üéÆ Used in Challenges",-1)),s("div",Qe,[(o(!0),a(w,null,L(t.value.connections.used_in,l=>(o(),a("button",{key:l,class:"connection-chip challenge gamepad-focusable",onClick:$=>oe(l)},c(k(l)),9,Ze))),128))])])):i("",!0)])):i("",!0),t.value.description_detailed?(o(),a("div",et,[e[11]||(e[11]=s("div",{class:"text-xs text-text-muted mb-2"},"üéØ Your Mission",-1)),s("div",{class:"lesson-content prose prose-invert text-sm",innerHTML:le.value},null,8,tt)])):i("",!0)])]),s("div",st,[t.value.try_it?(o(),a("div",nt,[xe(ge,{code:p.value,readonly:h.value,"onUpdate:code":e[2]||(e[2]=l=>p.value=l)},null,8,["code","readonly"]),m.value?(o(),he(ye,{key:0,results:m.value,challenge:ce.value,class:"mt-6"},null,8,["results","challenge"])):i("",!0)])):(o(),a("div",ot,[...e[12]||(e[12]=[s("div",{class:"text-4xl mb-4"},"üìñ",-1),s("div",{class:"text-text-secondary"},"This is a reading lesson",-1),s("div",{class:"text-text-muted text-sm mt-2"}," Study the content below, then continue to the next concept. ",-1)])])),t.value.lesson?(o(),a("div",at,[s("button",{class:"w-full flex items-center justify-between text-left",onClick:e[3]||(e[3]=l=>g.value=!g.value)},[s("div",lt,[e[13]||(e[13]=s("span",{class:"text-lg"},"üìö",-1)),e[14]||(e[14]=s("span",{class:"font-medium"},"Reference",-1)),s("span",it,"("+c(t.value.time_to_read)+"s read)",1)]),s("span",ct,c(g.value?"‚ñº":"‚ñ∂"),1)]),g.value?(o(),a("div",ut,[s("div",{class:"lesson-content prose prose-invert",innerHTML:ie.value},null,8,rt)])):i("",!0)])):i("",!0),(P=(O=t.value.connections)==null?void 0:O.see_also)!=null&&P.length?(o(),a("div",dt,[e[15]||(e[15]=s("div",{class:"text-sm text-text-muted mb-2"},"üìö Related Concepts",-1)),s("div",vt,[(o(!0),a(w,null,L(t.value.connections.see_also,l=>(o(),a("button",{key:l,class:"connection-chip see-also gamepad-focusable",onClick:$=>R(l)},c(k(l)),9,pt))),128))])])):i("",!0)])])):(o(),a("div",we,[e[4]||(e[4]=s("div",{class:"text-4xl mb-4"},"ü§∑",-1)),e[5]||(e[5]=s("div",{class:"text-text-secondary"},"Concept not found",-1)),s("button",{class:"mt-4 px-4 py-2 bg-accent-secondary text-white rounded-lg gamepad-focusable",onClick:e[0]||(e[0]=l=>S(f).push("/concepts"))}," Back to Concepts ")]))])}}}),bt=be(mt,[["__scopeId","data-v-c9c4f37f"]]);export{bt as default};
