import{d as $,r as y,a as j,o as R,c as _,l as z,b as n,g as r,m as A,p as u,F as w,i as k,j as O,t as l,q as S,f as F,s as T,k as a,_ as q}from"./index-B7Pz_r6u.js";import{c as D}from"./client-H5C7n97n.js";import{R as N}from"./RadialProgress-DsP8qpqK.js";const E={class:"responsive-container-wide py-responsive"},G={class:"level-filter-row"},I=["onClick"],P={class:"level-btn-content"},U={class:"level-label"},H={key:0,class:"level-progress-container"},J={class:"level-stats-text"},K={key:1,class:"level-empty-progress"},Q={key:0,class:"text-center py-12 text-text-muted"},W={key:1,class:"text-center py-12"},X={key:2},Y={class:"text-responsive-heading mb-4 text-accent-secondary"},Z={class:"responsive-grid"},ee=["onClick"],se={class:"flex items-start justify-between"},te={class:"flex-1"},oe={class:"flex items-center gap-2 mb-2"},re={class:"level-badge"},ae={class:"font-bold text-lg"},ne={class:"text-accent-primary font-mono text-sm mt-1"},le={class:"progress-container"},ie={key:1,class:"empty-progress"},ce=$({__name:"ChallengesView",setup(de){const x=O(),m=y([]),g=y(!0),i=y(null);j({onBack:()=>x.push("/")}),R(async()=>{await B()});async function B(){g.value=!0;const o=await D.list();o.ok&&(m.value=o.data),g.value=!1}const h=_(()=>i.value===null?m.value:m.value.filter(o=>o.level===i.value)),C=_(()=>{const o={};for(const e of h.value)o[e.level]||(o[e.level]=[]),o[e.level].push(e);return o}),M=_(()=>Object.keys(C.value).map(Number).sort()),c=_(()=>{const o={};for(let e=0;e<=6;e++)o[e]={total:0,completed:0,mastered:0,needsReview:0,avgRetention:0};for(const e of m.value){const s=o[e.level];s.total++,e.progress&&(s.completed++,s.avgRetention+=e.progress.retention,e.progress.mastered&&s.mastered++,e.progress.needs_review&&s.needsReview++)}for(const e in o){const s=o[e];s.completed>0&&(s.avgRetention=s.avgRetention/s.completed)}return o});function V(o){x.push(`/challenge/${o}`)}function L(o){i.value=o,window.scrollTo({top:0,behavior:"smooth"})}function d(){window.scrollTo({top:0,behavior:"smooth"})}let f=null;return R(()=>{const o=document.querySelector(".level-filter-row");o&&(f=new MutationObserver(e=>{for(const s of e)if(s.type==="attributes"&&s.attributeName==="class"){const t=s.target;t.classList.contains("level-filter-btn")&&t.classList.contains("gamepad-focused")&&d()}}),f.observe(o,{attributes:!0,subtree:!0,attributeFilter:["class"]}))}),z(()=>{f&&f.disconnect()}),(o,e)=>(a(),n("div",E,[e[5]||(e[5]=r("h1",{class:"text-responsive-title mb-6 3xl:mb-8"},[r("span",{class:"text-accent-primary"},"ðŸ“š"),A(" Challenges ")],-1)),r("div",G,[r("button",{class:u(["level-filter-btn gamepad-focusable",{active:i.value===null}]),onClick:e[0]||(e[0]=s=>L(null)),onMouseenter:d,onFocus:d},[...e[1]||(e[1]=[r("span",{class:"level-filter-label"},"All",-1)])],34),(a(),n(w,null,k(7,s=>{var t,p,v;return r("button",{key:s-1,class:u(["level-filter-btn gamepad-focusable",{active:i.value===s-1,"has-progress":((t=c.value[s-1])==null?void 0:t.completed)>0}]),onClick:b=>L(s-1),onMouseenter:d,onFocus:d},[r("div",P,[r("span",U,"Level "+l(s-1),1),((p=c.value[s-1])==null?void 0:p.total)>0?(a(),n("div",H,[S(N,{percent:((v=c.value[s-1])==null?void 0:v.avgRetention)||0,size:40,"stroke-width":4,"show-label":!0},null,8,["percent"]),r("span",J,l(c.value[s-1].completed)+"/"+l(c.value[s-1].total),1)])):(a(),n("div",K,[...e[2]||(e[2]=[r("span",{class:"level-empty-circle"},"â—‹",-1),r("span",{class:"level-stats-text"},"0/0",-1)])]))])],42,I)}),64))]),g.value?(a(),n("div",Q," Loading challenges... ")):h.value.length===0?(a(),n("div",W,[...e[3]||(e[3]=[r("div",{class:"text-4xl mb-4"},"ðŸ—ï¸",-1),r("div",{class:"text-text-secondary"},"No challenges available yet",-1)])])):(a(),n("div",X,[(a(!0),n(w,null,k(M.value,s=>(a(),n("div",{key:s,class:"mb-8"},[r("h2",Y," Level "+l(s),1),r("div",Z,[(a(!0),n(w,null,k(C.value[s],t=>{var p,v,b;return a(),n("div",{key:t.id,class:u(["challenge-card cursor-pointer gamepad-focusable",{"needs-review":(p=t.progress)==null?void 0:p.needs_review,mastered:(v=t.progress)==null?void 0:v.mastered,completed:t.progress&&!t.progress.needs_review&&!t.progress.mastered}]),onClick:pe=>V(t.id)},[r("div",se,[r("div",te,[r("div",oe,[r("div",re,"Lv."+l(t.level),1),(b=t.progress)!=null&&b.performance_grade&&t.progress.performance_grade!=="-"?(a(),n("div",{key:0,class:u(["grade-badge",`grade-${t.progress.performance_grade.toLowerCase()}`])},l(t.progress.performance_grade),3)):F("",!0)]),r("h3",ae,l(t.name),1),r("div",ne,l(t.points)+" pts ",1)]),r("div",le,[t.progress?(a(),T(N,{key:0,percent:t.progress.retention,size:48,"stroke-width":4,"show-label":!0},null,8,["percent"])):(a(),n("div",ie,[...e[4]||(e[4]=[r("span",{class:"empty-icon"},"â—‹",-1)])])),t.progress?(a(),n("div",{key:2,class:u(["progress-label",{"needs-review":t.progress.needs_review,mastered:t.progress.mastered}])},l(t.progress.mastered?"Mastered!":t.progress.needs_review?"Review!":t.progress.days_since<1?"Fresh!":`${Math.round(t.progress.days_since)}d ago`),3)):F("",!0)])])],10,ee)}),128))])]))),128))]))]))}}),fe=q(ce,[["__scopeId","data-v-5c0c19a3"]]);export{fe as default};
