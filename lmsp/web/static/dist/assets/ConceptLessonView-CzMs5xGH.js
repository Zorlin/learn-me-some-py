import{d as Re,u as Me,r as d,a as Ne,c as b,x as Ie,y as ne,o as Be,l as Pe,b as a,g as n,h as T,j as je,F as y,f as l,t as c,e as Ae,p as H,m as De,i as L,q as oe,s as Ve,k as o,_ as qe}from"./index-C9SLr4DQ.js";import{d as j,C as Ue,T as Ee,_ as Fe}from"./EmotionalFeedback.vue_vue_type_script_setup_true_lang-CtyqGFoC.js";import{b as ae}from"./client-H5C7n97n.js";import"./player-CVYXLnpi.js";const Xe={class:"max-w-6xl mx-auto px-4 py-8"},Ge={key:0,class:"text-center py-12 text-text-muted"},Oe={key:1,class:"text-center py-12"},Ye={key:0,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Je={class:"lg:col-span-1"},We={class:"oled-panel sticky top-20"},ze={class:"flex items-center gap-2 mb-2"},Ke={class:"level-badge"},Qe={class:"category-tag"},Ze={key:0,class:"bonus-badge"},et={class:"ml-auto timer-display"},tt={class:"text-2xl font-bold mb-2"},st={class:"text-text-secondary mb-4"},nt={key:0,class:"border-t border-oled-border pt-4 mt-4"},ot={key:1,class:"mt-4 p-3 bg-accent-warning/10 border border-accent-warning/30 rounded-lg"},at={class:"flex items-center justify-between mb-1"},lt={key:0,class:"flex items-center gap-1"},it=["disabled"],rt={class:"text-xs text-text-muted"},ct=["disabled"],ut=["innerHTML"],dt={key:2,class:"mt-4 p-3 bg-accent-success/10 border border-accent-success/30 rounded-lg"},vt={class:"text-accent-primary mt-1"},pt={class:"flex flex-col gap-2 mt-4"},mt=["disabled"],xt={key:3,class:"mt-2 p-3 bg-oled-muted border border-oled-border rounded-lg"},bt={class:"flex items-center justify-between mb-2"},ft={key:0,class:"pt-2 border-t border-oled-border"},_t={key:3,class:"mt-6 pt-4 border-t border-oled-border"},ht={class:"flex flex-wrap gap-1"},gt=["onClick"],yt={key:4,class:"mt-4"},kt={key:0,class:"mb-3"},Ct={class:"flex flex-wrap gap-1"},wt=["onClick"],$t={key:1},St={class:"flex flex-wrap gap-1"},Tt=["onClick"],Ht={key:5,class:"mt-4 pt-4 border-t border-oled-border"},Lt=["innerHTML"],Rt={class:"lg:col-span-2 space-y-6"},Mt={key:0},Nt={key:1,class:"oled-panel"},It=["innerHTML"],Bt={key:2,class:"oled-panel"},Pt={class:"flex flex-wrap gap-2"},jt=["onClick"],At={key:1,class:"max-w-lg mx-auto py-12"},Dt={class:"text-center mb-8"},Vt={class:"text-text-secondary mt-2"},qt={key:0,class:"text-accent-primary mt-2"},Ut={key:2,class:"max-w-lg mx-auto py-12 text-center"},Et=3,A="lmsp_concept_",Ft=Re({__name:"ConceptLessonView",setup(Xt){const le=Ie(),f=je(),D=Me(),s=d(null),R=d(!0),m=d(""),V=d(!1),h=d(0),p=d([]),v=d(0);function ie(t){try{return localStorage.getItem(`${A}${t}`)}catch{return null}}function re(t,e){try{localStorage.setItem(`${A}${t}`,e)}catch{}}function ce(t){try{localStorage.removeItem(`${A}${t}`)}catch{}}const g=d(!1),_=d("coding"),u=d(null);d(!0);const q=d(0);let k=null,M=null;function U(){M!==null&&(q.value=Math.floor((Date.now()-M)/1e3))}function ue(t){const e=Math.floor(t/3600),r=Math.floor(t%3600/60),x=Math.floor(t%60);return e>0?`${e}:${r.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`:`${r}:${x.toString().padStart(2,"0")}`}Ne({onBack:()=>f.push("/concepts")});const N=b(()=>le.params.id),de=b(()=>{var t;return(t=s.value)!=null&&t.try_it?m.value!==s.value.try_it.starter:!1}),C=b(()=>!1),I=d(!1),ve=!1;function pe(){I.value=!0}function me(){var t,e;console.log(`[Palace] Create hints for lesson: ${(t=s.value)==null?void 0:t.id}`),alert(`Palace hint generation coming soon!

Lesson: ${(e=s.value)==null?void 0:e.id}`)}ne(m,t=>{var e;(e=s.value)!=null&&e.id&&re(s.value.id,t)}),ne(()=>D.buttons,t=>{var e;s.value&&(t.X&&s.value.try_it&&F(),t.Y&&((e=s.value.try_it)!=null&&e.solution)&&E())},{deep:!0}),Be(async()=>{await xe(),M=Date.now(),U(),k=window.setInterval(U,1e3)}),Pe(()=>{k!==null&&(clearInterval(k),k=null)});async function xe(){var t;R.value=!0;try{const e=await ae.get(N.value);if(e.ok){if(s.value=e.data,(t=s.value)!=null&&t.try_it){const r=ie(N.value);m.value=r??s.value.try_it.starter}await ae.markSeen(N.value)}}catch(e){console.error("Failed to load lesson:",e)}R.value=!1}function E(){if(h.value<Et){h.value++;const t=be(h.value);t&&!p.value.includes(t)&&(p.value.push(t),v.value=p.value.length-1),V.value=!0}}function be(t){var x;if(!((x=s.value)!=null&&x.try_it))return null;const e=s.value.try_it.solution,r=e.split(`
`).filter(S=>S.trim());switch(t){case 1:return"Look at the examples in the lesson. What pattern do you see?";case 2:return r.length>0?`Start with:
\`\`\`python
${r[0]}
\`\`\``:"Review the code examples and apply the same pattern.";case 3:return`**Solution:**
\`\`\`python
${e}\`\`\``;default:return null}}const w=b(()=>p.value.length===0?null:p.value[v.value]??null),fe=b(()=>{if(!w.value)return"";try{return j(w.value)}catch{return w.value}});function _e(){v.value>0&&v.value--}function he(){v.value<p.value.length-1&&v.value++}async function F(){var t;if((t=s.value)!=null&&t.try_it){g.value=!0,u.value=null;try{const r=await(await fetch("/api/code/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lesson_id:s.value.id,code:m.value})})).json();u.value={success:r.success,passing:r.tests_passing,total:r.tests_total,output:r.output||"",error:r.error,xp_earned:r.xp_earned,xp_reason:r.xp_reason,total_xp:r.total_xp,test_results:r.test_results}}catch(e){u.value={success:!1,passing:0,total:1,output:"",error:String(e)}}g.value=!1}}function ge(){var t;(t=s.value)!=null&&t.try_it&&(ce(s.value.id),m.value=s.value.try_it.starter,u.value=null,_.value="coding")}function ye(){var t;(t=u.value)!=null&&t.success&&(_.value="feedback")}function ke(){_.value="complete"}function Ce(){f.push("/concepts")}function we(){f.push("/concepts")}function B(t){f.push(`/concept/${t}`)}function $e(t){f.push(`/challenge/${t}`)}function Se(t){return t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function $(t){return t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const Te=b(()=>{var t;if(!((t=s.value)!=null&&t.description_detailed))return"";try{return j(s.value.description_detailed)}catch{return`<pre>${s.value.description_detailed}</pre>`}}),He=b(()=>{var t;if(!((t=s.value)!=null&&t.lesson))return"";try{return j(s.value.lesson)}catch{return`<pre>${s.value.lesson}</pre>`}}),Le=b(()=>{var t;if(s.value)return{name:`Concept: ${s.value.name}`,description:((t=s.value.try_it)==null?void 0:t.prompt)||"Read the lesson content and apply the concepts.",code:m.value}});return(t,e)=>{var r,x,S,X,G,O,Y,J,W,z,K,Q,Z,ee,te,se;return o(),a("div",Xe,[R.value?(o(),a("div",Ge," Loading lesson... ")):s.value?(o(),a(y,{key:2},[_.value==="coding"?(o(),a("div",Ye,[n("div",Je,[n("div",We,[n("div",ze,[n("div",Ke,"Level "+c(s.value.level),1),n("span",Qe,c(Se(s.value.category)),1),s.value.bonus?(o(),a("span",Ze,"‚≠ê Bonus")):l("",!0),n("div",et,[n("span",null,"‚è±Ô∏è "+c(ue(q.value)),1)])]),n("h1",tt,c(s.value.name),1),n("p",st,c(s.value.description_brief||"Learn this concept and practice it."),1),T(D).connected?(o(),a("div",nt,[...e[7]||(e[7]=[Ae('<div class="text-sm text-text-muted mb-2" data-v-bd6db998>Controls</div><div class="grid grid-cols-2 gap-2 text-sm" data-v-bd6db998><div data-v-bd6db998><span class="gamepad-button" data-v-bd6db998>X</span> Run Tests</div><div data-v-bd6db998><span class="gamepad-button" data-v-bd6db998>Y</span> Hint</div><div data-v-bd6db998><span class="gamepad-button" data-v-bd6db998>B</span> Back</div></div>',2)])])):l("",!0),V.value&&w.value?(o(),a("div",ot,[n("div",at,[e[8]||(e[8]=n("div",{class:"text-sm text-accent-warning font-medium"},"üí° Hint",-1)),p.value.length>1?(o(),a("div",lt,[n("button",{class:H(["hint-nav-btn",{"opacity-30":v.value===0}]),disabled:v.value===0,onClick:_e},"‚Äπ",10,it),n("span",rt,c(v.value+1)+"/"+c(p.value.length),1),n("button",{class:H(["hint-nav-btn",{"opacity-30":v.value===p.value.length-1}]),disabled:v.value===p.value.length-1,onClick:he},"‚Ä∫",10,ct)])):l("",!0)]),n("div",{class:"prose prose-invert prose-sm hint-content",innerHTML:fe.value},null,8,ut)])):l("",!0),(r=u.value)!=null&&r.success&&((x=u.value)!=null&&x.xp_earned)?(o(),a("div",dt,[e[9]||(e[9]=n("div",{class:"text-sm text-accent-success font-medium"},"üéâ All tests passing!",-1)),n("div",vt,"+"+c(u.value.xp_earned)+" XP",1)])):l("",!0),n("div",pt,[(S=u.value)!=null&&S.success?(o(),a("button",{key:0,class:"oled-button-success gamepad-focusable animate-pulse",onClick:ye}," ‚úÖ Submit Solution ")):l("",!0),s.value.try_it?(o(),a("button",{key:1,class:"oled-button-primary gamepad-focusable",disabled:g.value,onClick:F},c(g.value?"‚è≥ Running...":"‚ñ∂ Run Tests"),9,mt)):l("",!0),s.value.try_it?(o(),a("button",{key:2,class:H(["oled-button gamepad-focusable",{"opacity-50":!C.value}]),onClick:e[1]||(e[1]=i=>C.value?E():pe())},[n("span",{class:H({grayscale:!C.value})},"üí°",2),De(" "+c(C.value?h.value===0?"Need a hint?":h.value===2?"Show solution":"Another hint":"No hints available"),1)],2)):l("",!0),I.value?(o(),a("div",xt,[n("div",bt,[e[10]||(e[10]=n("span",{class:"text-sm text-text-muted"},"üí° No hints yet",-1)),n("button",{class:"text-text-muted hover:text-text-secondary text-sm",onClick:e[2]||(e[2]=i=>I.value=!1)},"‚úï")]),e[12]||(e[12]=n("p",{class:"text-sm text-text-secondary mb-2"}," This concept doesn't have handcrafted hints yet. The lesson content and examples should help guide you! ",-1)),T(ve)?(o(),a("div",ft,[e[11]||(e[11]=n("p",{class:"text-xs text-text-muted mb-2"},"üîß Dev Mode",-1)),n("button",{class:"text-xs text-accent-secondary hover:text-accent-primary",onClick:me}," + Create hints for this lesson ")])):l("",!0)])):l("",!0),de.value?(o(),a("button",{key:4,class:"oled-button text-accent-warning gamepad-focusable",onClick:ge}," üîÑ Reset to Start ")):l("",!0),n("button",{class:"oled-button gamepad-focusable",onClick:e[3]||(e[3]=i=>T(f).push("/concepts"))}," ‚Üê Back to Concepts ")]),(G=(X=s.value.connections)==null?void 0:X.prerequisites)!=null&&G.length?(o(),a("div",_t,[e[13]||(e[13]=n("div",{class:"text-xs text-text-muted mb-2"},"üìã Prerequisites",-1)),n("div",ht,[(o(!0),a(y,null,L(s.value.connections.prerequisites,i=>(o(),a("button",{key:i,class:"connection-chip prereq gamepad-focusable",onClick:P=>B(i)},c($(i)),9,gt))),128))])])):l("",!0),(Y=(O=s.value.connections)==null?void 0:O.enables)!=null&&Y.length||(W=(J=s.value.connections)==null?void 0:J.used_in)!=null&&W.length?(o(),a("div",yt,[(K=(z=s.value.connections)==null?void 0:z.enables)!=null&&K.length?(o(),a("div",kt,[e[14]||(e[14]=n("div",{class:"text-xs text-text-muted mb-1"},"‚û°Ô∏è Unlocks",-1)),n("div",Ct,[(o(!0),a(y,null,L(s.value.connections.enables,i=>(o(),a("button",{key:i,class:"connection-chip enables gamepad-focusable",onClick:P=>B(i)},c($(i)),9,wt))),128))])])):l("",!0),(Z=(Q=s.value.connections)==null?void 0:Q.used_in)!=null&&Z.length?(o(),a("div",$t,[e[15]||(e[15]=n("div",{class:"text-xs text-text-muted mb-1"},"üéÆ Used in Challenges",-1)),n("div",St,[(o(!0),a(y,null,L(s.value.connections.used_in,i=>(o(),a("button",{key:i,class:"connection-chip challenge gamepad-focusable",onClick:P=>$e(i)},c($(i)),9,Tt))),128))])])):l("",!0)])):l("",!0),s.value.description_detailed?(o(),a("div",Ht,[e[16]||(e[16]=n("div",{class:"text-xs text-text-muted mb-2"},"üìñ About This Concept",-1)),n("div",{class:"lesson-content prose prose-invert text-sm",innerHTML:Te.value},null,8,Lt)])):l("",!0)])]),n("div",Rt,[s.value.try_it?(o(),a("div",Mt,[oe(Ue,{code:m.value,readonly:g.value,"onUpdate:code":e[4]||(e[4]=i=>m.value=i)},null,8,["code","readonly"]),u.value?(o(),Ve(Ee,{key:0,results:u.value,challenge:Le.value,class:"mt-6"},null,8,["results","challenge"])):l("",!0)])):l("",!0),s.value.lesson?(o(),a("div",Nt,[n("div",{class:"lesson-content prose prose-invert",innerHTML:He.value},null,8,It)])):l("",!0),(te=(ee=s.value.connections)==null?void 0:ee.see_also)!=null&&te.length?(o(),a("div",Bt,[e[17]||(e[17]=n("div",{class:"text-sm text-text-muted mb-2"},"üìö Related Concepts",-1)),n("div",Pt,[(o(!0),a(y,null,L(s.value.connections.see_also,i=>(o(),a("button",{key:i,class:"connection-chip see-also gamepad-focusable",onClick:P=>B(i)},c($(i)),9,jt))),128))])])):l("",!0)])])):_.value==="feedback"?(o(),a("div",At,[n("div",Dt,[e[18]||(e[18]=n("div",{class:"text-6xl mb-4"},"üéâ",-1)),e[19]||(e[19]=n("h1",{class:"text-3xl font-bold text-accent-primary"},"Concept Mastered!",-1)),n("p",Vt,c(s.value.name),1),(se=u.value)!=null&&se.xp_earned?(o(),a("div",qt," +"+c(u.value.xp_earned)+" XP ",1)):l("",!0)]),oe(Fe,{question:`How did '${s.value.name}' feel?`,context:`concept:${s.value.id}`,"challenge-id":`concept:${s.value.id}`,onConfirm:ke},null,8,["question","context","challenge-id"])])):_.value==="complete"?(o(),a("div",Ut,[e[20]||(e[20]=n("div",{class:"text-6xl mb-4"},"‚ú®",-1)),e[21]||(e[21]=n("h1",{class:"text-3xl font-bold mb-4"},"Great Job!",-1)),e[22]||(e[22]=n("p",{class:"text-text-secondary mb-8"}," You've mastered this concept. What's next? ",-1)),n("div",{class:"flex flex-col gap-4"},[n("button",{class:"oled-button-primary py-4 text-lg gamepad-focusable",onClick:Ce}," üöÄ Next Concept "),n("button",{class:"oled-button py-3 gamepad-focusable",onClick:we}," üè† Return to Concepts ")])])):l("",!0)],64)):(o(),a("div",Oe,[e[5]||(e[5]=n("div",{class:"text-4xl mb-4"},"ü§∑",-1)),e[6]||(e[6]=n("div",{class:"text-text-secondary"},"Concept not found",-1)),n("button",{class:"mt-4 px-4 py-2 bg-accent-secondary text-white rounded-lg gamepad-focusable",onClick:e[0]||(e[0]=i=>T(f).push("/concepts"))}," Back to Concepts ")]))])}}}),Wt=qe(Ft,[["__scopeId","data-v-bd6db998"]]);export{Wt as default};
