import{d as we,a as _e,r as d,c as u,x as Me,o as $e,b as a,g as o,m as Le,t as r,h as ae,j as Pe,F as h,i as k,f as m,w as T,p as B,k as i,_ as Xe}from"./index-B7Pz_r6u.js";import{u as Ce}from"./player-BuDOBLgw.js";import"./client-H5C7n97n.js";const De={class:"max-w-6xl mx-auto px-4 py-8"},Ae={class:"flex items-center justify-between mb-8"},je={class:"text-text-secondary mt-1"},ze={class:"oled-panel mb-6"},Re={class:"flex items-center gap-2 flex-wrap"},Fe=["onClick"],Ve={key:0,class:"text-center py-12 text-text-muted"},Be={class:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6"},Ee={class:"oled-panel text-center"},We={class:"text-3xl font-bold text-accent-secondary"},Ue={class:"oled-panel text-center"},Ne={class:"text-3xl font-bold text-accent-primary"},Oe={class:"oled-panel text-center"},Ge={class:"text-3xl font-bold text-tier-gold"},He={class:"oled-panel text-center"},Ye={class:"text-3xl font-bold text-blue-400"},Ie={class:"oled-panel text-center"},Ze={class:"text-3xl font-bold text-purple-400"},qe={class:"oled-panel mb-6"},Je=["viewBox"],Ke={class:"grid-lines"},Qe=["x1","x2","y1","y2"],et=["d","opacity"],tt=["d"],lt=["d","stroke-width","opacity"],ot=["d"],st=["d","stroke-width","opacity"],nt=["d"],at=["d","stroke-width","opacity"],it={class:"data-points"},ut=["cx","cy","r","opacity"],rt=["cx","cy","r","opacity"],vt=["cx","cy","r","opacity"],ct={key:4,class:"y-axis-xp"},dt=["x","y"],mt={key:5,class:"y-axis-time"},xt=["x","y"],pt={class:"x-axis"},gt=["x1","x2","y1","y2"],ft=["x","y"],yt=["y","transform"],ht=["x","y","transform"],kt={class:"flex items-center justify-center gap-4 mt-2 text-xs"},bt={key:0,class:"oled-panel"},Tt={class:"space-y-3"},St={class:"flex-1"},wt={class:"font-medium"},_t={class:"text-accent-secondary"},Mt={key:0,class:"text-text-muted ml-2"},$t={class:"text-sm text-text-secondary"},Lt={class:"text-right text-sm"},Pt={key:0,class:"text-blue-400"},Xt={class:"text-text-muted"},Ct={key:1,class:"oled-panel text-center py-12"},$=1200,g=260,Dt=we({__name:"XpAnalyticsView",setup(At){const E=Pe(),ie=Ce();_e({onBack:()=>E.push("/progress")});const W=d(!0),C=d("hour"),Y=[{value:"hour",label:"1 Hour",ms:60*60*1e3},{value:"day",label:"24 Hours",ms:24*60*60*1e3},{value:"week",label:"7 Days",ms:7*24*60*60*1e3},{value:"month",label:"30 Days",ms:30*24*60*60*1e3},{value:"year",label:"1 Year",ms:365*24*60*60*1e3}],S=d([]),R=d(0),L=d(0),U=u(()=>{const l=Y.find(e=>e.value===C.value);return(l==null?void 0:l.ms)||24*60*60*1e3}),N=u(()=>{if(S.value.length===0){const e=Date.now();return{min:e-U.value,max:e}}const l=S.value.map(e=>new Date(e.timestamp).getTime());return{min:Math.min(...l),max:Math.max(...l)}});u(()=>{const l=Date.now();return{min:l-U.value,max:l}});const v={top:12,right:40,bottom:30,left:40},D=d(0),A=d(1),O=d(!1),I=d(0),Z=d(0),b=d(!0),w=d(!0),P=d(!0),f=d(null),_=d(null),c=u(()=>_.value??f.value),q=u(()=>c.value===null||c.value==="xp"?1:.15),J=u(()=>c.value===null?.8:c.value==="solveTime"?1:.15),K=u(()=>c.value===null?.2:c.value==="avgSolveTime"?.8:.1);function X(l){_.value===l?_.value=null:_.value=l}function ue(l){(l.target.tagName==="svg"||l.target.classList.contains("chart-background"))&&(_.value=null)}const x=u(()=>{let e=0,t=0;return S.value.map((s,n)=>{const p=s.solve_time||0;if(e+=p,t++,n>=5){const V=S.value[n-5].solve_time||0;e-=V,t=5}const y=t>0?e/t:0;return{time:new Date(s.timestamp).getTime(),xp:s.cumulative_xp||0,xpDelta:s.xp_amount,solveTime:p,avgSolveTime:y,label:ne(s.timestamp),timestamp:s.timestamp,challengeId:s.challenge_id,reason:s.reason}})}),j=u(()=>$-v.left-v.right),re=u(()=>{const{min:l,max:e}=N.value,s=(e-l||1)/(j.value*A.value),n=l+D.value*s,p=n+j.value*s;return{min:n,max:p}}),M=u(()=>{const{min:l,max:e}=N.value,t=e-l||1,s=j.value*A.value;return n=>{const p=(n-l)/t;return v.left+p*s-D.value}}),F=u(()=>{const l=x.value,e=Math.max(...l.map(s=>s.xp),1),t=g-v.top-v.bottom;return s=>g-v.bottom-s/e*t}),z=u(()=>{const l=x.value,e=Math.max(...l.map(s=>s.solveTime),1),t=g-v.top-v.bottom;return s=>g-v.bottom-s/e*t}),Q=u(()=>{const l=x.value;return l.length===0?"":l.map((e,t)=>{const s=M.value(e.time),n=F.value(e.xp);return`${t===0?"M":"L"} ${s} ${n}`}).join(" ")}),ve=u(()=>{const l=x.value;if(l.length===0)return"";const e=l.map((V,be)=>{const Te=M.value(V.time),Se=F.value(V.xp);return`${be===0?"M":"L"} ${Te} ${Se}`}).join(" "),t=l[l.length-1],s=l[0],n=M.value(t.time),p=M.value(s.time),y=g-v.bottom;return`${e} L ${n} ${y} L ${p} ${y} Z`}),ee=u(()=>{const l=x.value;return l.length===0?"":l.map((e,t)=>{const s=M.value(e.time),n=z.value(e.solveTime);return`${t===0?"M":"L"} ${s} ${n}`}).join(" ")}),te=u(()=>{const l=x.value;return l.length===0?"":l.map((e,t)=>{const s=M.value(e.time),n=z.value(e.avgSolveTime);return`${t===0?"M":"L"} ${s} ${n}`}).join(" ")}),G=u(()=>x.value.map(l=>({cx:M.value(l.time),cyXp:F.value(l.xp),cySolveTime:z.value(l.solveTime),cyAvgSolveTime:z.value(l.avgSolveTime),...l}))),le=u(()=>{const l=x.value,e=Math.max(...l.map(n=>n.xp),1),t=[],s=Math.ceil(e/5);for(let n=0;n<=e;n+=s)t.push({value:n,y:F.value(n)});return t}),ce=u(()=>{const l=x.value,e=Math.max(...l.map(n=>n.solveTime),1),t=[],s=Math.ceil(e/5);for(let n=0;n<=e;n+=s)t.push({value:n,y:z.value(n)});return t}),oe=u(()=>{const{min:l,max:e}=re.value,t=e-l,s=[],n=6;for(let p=0;p<=n;p++){const y=l+t*p/n;s.push({time:y,x:M.value(y),label:de(y)})}return s});function de(l){const e=new Date(l),t=C.value;return t==="hour"?e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):t==="day"?e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):t==="week"?e.toLocaleDateString("en-US",{weekday:"short",hour:"2-digit"}):t==="month"?e.toLocaleDateString("en-US",{month:"short",day:"numeric"}):e.toLocaleDateString("en-US",{month:"short",year:"2-digit"})}function me(l){O.value=!0,I.value=l.clientX,Z.value=D.value}function xe(l){if(!O.value)return;const e=l.clientX-I.value;D.value=Z.value-e}function se(){O.value=!1}function pe(l){l.preventDefault();const e=l.deltaY>0?.9:1.1;A.value=Math.max(1,Math.min(100,A.value*e))}function H(){const{min:l,max:e}=N.value,t=e-l||1,s=U.value,n=Math.max(1,t/s);A.value=n;const p=j.value*n,y=j.value;D.value=Math.max(0,p-y)}async function ge(){W.value=!0;try{const e=await(await fetch("/api/xp/history")).json();S.value=e.data||[],R.value=e.total_xp,L.value=e.total_events,H()}catch(l){console.error("Failed to fetch XP history:",l)}finally{W.value=!1}}function ne(l){return new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}Me(C,()=>{H()});const fe=u(()=>L.value===0?0:Math.round(R.value/L.value)),ye=u(()=>{const l=S.value.filter(t=>t.solve_time&&t.solve_time>0);return l.length===0?0:l.reduce((t,s)=>t+(s.solve_time||0),0)/l.length}),he=u(()=>{const l=x.value;return l.length===0?0:l[l.length-1].avgSolveTime}),ke=u(()=>S.value.slice(-10).reverse());return $e(async()=>{await ie.loadProfile(),await ge()}),(l,e)=>(i(),a("div",De,[o("div",Ae,[o("div",null,[e[23]||(e[23]=o("h1",{class:"text-3xl font-bold"},[o("span",{class:"text-accent-secondary"},"ðŸ“ˆ"),Le(" XP Analytics ")],-1)),o("p",je,r(R.value.toLocaleString())+" total XP from "+r(L.value)+" events ",1)]),o("button",{class:"oled-button gamepad-focusable",onClick:e[0]||(e[0]=t=>ae(E).push("/progress"))}," â† Back to Progress ")]),o("div",ze,[o("div",Re,[e[24]||(e[24]=o("span",{class:"text-text-secondary mr-2"},"View by:",-1)),(i(),a(h,null,k(Y,t=>o("button",{key:t.value,class:B(["period-button gamepad-focusable",{active:C.value===t.value}]),onClick:s=>C.value=t.value},r(t.label),11,Fe)),64))])]),W.value?(i(),a("div",Ve," Loading XP history... ")):(i(),a(h,{key:1},[o("div",Be,[o("div",Ee,[o("div",We,r(R.value.toLocaleString()),1),e[25]||(e[25]=o("div",{class:"text-sm text-text-secondary"},"Total XP",-1))]),o("div",Ue,[o("div",Ne,r(L.value),1),e[26]||(e[26]=o("div",{class:"text-sm text-text-secondary"},"Events",-1))]),o("div",Oe,[o("div",Ge,r(fe.value),1),e[27]||(e[27]=o("div",{class:"text-sm text-text-secondary"},"Avg XP/Event",-1))]),o("div",He,[o("div",Ye,r(ye.value.toFixed(1))+"s ",1),e[28]||(e[28]=o("div",{class:"text-sm text-text-secondary"},"Avg Solve Time",-1))]),o("div",Ie,[o("div",Ze,r(he.value.toFixed(1))+"s ",1),e[29]||(e[29]=o("div",{class:"text-sm text-text-secondary"},"Recent Avg (5)",-1))])]),o("div",qe,[o("div",{class:"flex items-center justify-between mb-4"},[e[30]||(e[30]=o("h2",{class:"text-lg font-bold"},"XP Over Time",-1)),o("button",{class:"text-sm text-text-secondary hover:text-accent-primary transition-colors gamepad-focusable",onClick:H}," Reset View ")]),o("div",{class:"chart-container",onMousedown:me,onMousemove:xe,onMouseup:se,onMouseleave:se,onWheel:pe},[(i(),a("svg",{viewBox:`0 0 ${$} ${g}`,class:"w-full h-full",preserveAspectRatio:"none",onClick:ue},[o("rect",{class:"chart-background",x:"0",y:"0",width:$,height:g,fill:"transparent"}),o("g",Ke,[(i(!0),a(h,null,k(le.value,t=>(i(),a("line",{key:"grid-"+t.value,x1:v.left,x2:$-v.right,y1:t.y,y2:t.y,stroke:"rgba(255,255,255,0.05)","stroke-width":"1"},null,8,Qe))),128))]),x.value.length>0&&b.value?(i(),a("path",{key:0,d:ve.value,fill:"url(#xpGradient)",opacity:c.value===null?.3:c.value==="xp"?.4:.1,class:"transition-opacity duration-150"},null,8,et)):m("",!0),x.value.length>0&&b.value?(i(),a("g",{key:1,onMouseenter:e[1]||(e[1]=t=>f.value="xp"),onMouseleave:e[2]||(e[2]=t=>f.value=null),onClick:e[3]||(e[3]=T(t=>X("xp"),["stop"])),class:"cursor-pointer"},[o("path",{d:Q.value,fill:"none",stroke:"transparent","stroke-width":"12"},null,8,tt),o("path",{d:Q.value,fill:"none",stroke:"#00ff88","stroke-width":c.value==="xp"?3:2,"stroke-linecap":"round","stroke-linejoin":"round",opacity:q.value,class:"transition-all duration-150"},null,8,lt)],32)):m("",!0),x.value.length>0&&w.value?(i(),a("g",{key:2,onMouseenter:e[4]||(e[4]=t=>f.value="solveTime"),onMouseleave:e[5]||(e[5]=t=>f.value=null),onClick:e[6]||(e[6]=T(t=>X("solveTime"),["stop"])),class:"cursor-pointer"},[o("path",{d:ee.value,fill:"none",stroke:"transparent","stroke-width":"12"},null,8,ot),o("path",{d:ee.value,fill:"none",stroke:"#60a5fa","stroke-width":c.value==="solveTime"?3:2,"stroke-dasharray":"5,5","stroke-linecap":"round","stroke-linejoin":"round",opacity:J.value,class:"transition-all duration-150"},null,8,st)],32)):m("",!0),x.value.length>0&&P.value?(i(),a("g",{key:3,onMouseenter:e[7]||(e[7]=t=>f.value="avgSolveTime"),onMouseleave:e[8]||(e[8]=t=>f.value=null),onClick:e[9]||(e[9]=T(t=>X("avgSolveTime"),["stop"])),class:"cursor-pointer"},[o("path",{d:te.value,fill:"none",stroke:"transparent","stroke-width":"12"},null,8,nt),o("path",{d:te.value,fill:"none",stroke:"#a855f7","stroke-width":c.value==="avgSolveTime"?3:2,"stroke-linecap":"round","stroke-linejoin":"round",opacity:K.value,class:"transition-all duration-150"},null,8,at)],32)):m("",!0),o("g",it,[b.value?(i(!0),a(h,{key:0},k(G.value,(t,s)=>(i(),a("circle",{key:"xp-"+s,cx:t.cx,cy:t.cyXp,r:c.value==="xp"?5:4,fill:"#00ff88",opacity:q.value,class:"data-point transition-all duration-150"},[o("title",null,r(t.label)+": "+r(t.xp)+" XP (+"+r(t.xpDelta)+")",1)],8,ut))),128)):m("",!0),w.value?(i(!0),a(h,{key:1},k(G.value,(t,s)=>(i(),a("circle",{key:"time-"+s,cx:t.cx,cy:t.cySolveTime,r:c.value==="solveTime"?4:3,fill:"#60a5fa",opacity:J.value,class:"data-point transition-all duration-150"},[o("title",null,r(t.label)+": "+r(t.solveTime.toFixed(1))+"s",1)],8,rt))),128)):m("",!0),P.value?(i(!0),a(h,{key:2},k(G.value,(t,s)=>(i(),a("circle",{key:"avg-"+s,cx:t.cx,cy:t.cyAvgSolveTime,r:c.value==="avgSolveTime"?4:2,fill:"#a855f7",opacity:K.value,class:"data-point transition-all duration-150"},[o("title",null,r(t.label)+": "+r(t.avgSolveTime.toFixed(1))+"s avg",1)],8,vt))),128)):m("",!0)]),b.value?(i(),a("g",ct,[(i(!0),a(h,null,k(le.value,t=>(i(),a("text",{key:"yxp-"+t.value,x:v.left-10,y:t.y+4,"text-anchor":"end",fill:"#00ff88","font-size":"12"},r(t.value),9,dt))),128))])):m("",!0),w.value?(i(),a("g",mt,[(i(!0),a(h,null,k(ce.value,t=>(i(),a("text",{key:"ytime-"+t.value,x:$-v.right+10,y:t.y+4,"text-anchor":"start",fill:"#60a5fa","font-size":"12"},r(t.value)+"s ",9,xt))),128))])):m("",!0),o("g",pt,[(i(!0),a(h,null,k(oe.value,t=>(i(),a("line",{key:"xtick-"+t.time,x1:t.x,x2:t.x,y1:g-v.bottom,y2:g-v.bottom+5,stroke:"rgba(255,255,255,0.3)","stroke-width":"1"},null,8,gt))),128)),(i(!0),a(h,null,k(oe.value,t=>(i(),a("text",{key:"xlabel-"+t.time,x:t.x,y:g-v.bottom+20,"text-anchor":"middle",fill:"rgba(255,255,255,0.6)","font-size":"10"},r(t.label),9,ft))),128))]),b.value?(i(),a("text",{key:6,x:12,y:g/2,fill:"#00ff88","font-size":"11","text-anchor":"middle",transform:`rotate(-90, 12, ${g/2})`}," XP ",8,yt)):m("",!0),w.value?(i(),a("text",{key:7,x:$-12,y:g/2,fill:"#60a5fa","font-size":"11","text-anchor":"middle",transform:`rotate(90, ${$-12}, ${g/2})`}," Time (s) ",8,ht)):m("",!0),e[31]||(e[31]=o("defs",null,[o("linearGradient",{id:"xpGradient",x1:"0",y1:"0",x2:"0",y2:"1"},[o("stop",{offset:"0%","stop-color":"#00ff88","stop-opacity":"0.4"}),o("stop",{offset:"100%","stop-color":"#00ff88","stop-opacity":"0"})])],-1))],8,Je))],32),o("div",kt,[o("button",{class:B(["legend-toggle",{active:b.value,inactive:!b.value,highlighted:c.value==="xp",locked:_.value==="xp"}]),onClick:[e[10]||(e[10]=T(t=>X("xp"),["exact"])),e[11]||(e[11]=T(t=>b.value=!b.value,["shift"]))],onMouseenter:e[12]||(e[12]=t=>f.value="xp"),onMouseleave:e[13]||(e[13]=t=>f.value=null),title:"Click to lock â€¢ Shift+click to toggle visibility"},[...e[32]||(e[32]=[o("span",{class:"legend-dot bg-accent-primary"},null,-1),o("span",null,"XP",-1)])],34),o("button",{class:B(["legend-toggle",{active:w.value,inactive:!w.value,highlighted:c.value==="solveTime",locked:_.value==="solveTime"}]),onClick:[e[14]||(e[14]=T(t=>X("solveTime"),["exact"])),e[15]||(e[15]=T(t=>w.value=!w.value,["shift"]))],onMouseenter:e[16]||(e[16]=t=>f.value="solveTime"),onMouseleave:e[17]||(e[17]=t=>f.value=null),title:"Click to lock â€¢ Shift+click to toggle visibility"},[...e[33]||(e[33]=[o("span",{class:"legend-dot bg-blue-400"},null,-1),o("span",null,"Solve Time",-1)])],34),o("button",{class:B(["legend-toggle",{active:P.value,inactive:!P.value,highlighted:c.value==="avgSolveTime",locked:_.value==="avgSolveTime"}]),onClick:[e[18]||(e[18]=T(t=>X("avgSolveTime"),["exact"])),e[19]||(e[19]=T(t=>P.value=!P.value,["shift"]))],onMouseenter:e[20]||(e[20]=t=>f.value="avgSolveTime"),onMouseleave:e[21]||(e[21]=t=>f.value=null),title:"Click to lock â€¢ Shift+click to toggle visibility"},[...e[34]||(e[34]=[o("span",{class:"legend-dot bg-purple-500"},null,-1),o("span",null,"Avg Solve Time",-1)])],34),e[35]||(e[35]=o("span",{class:"text-text-muted opacity-60"},"Drag to pan â€¢ Scroll to zoom â€¢ Click line to lock",-1))])]),S.value.length>0?(i(),a("div",bt,[e[36]||(e[36]=o("h2",{class:"text-lg font-bold mb-4"},"Recent Events",-1)),o("div",Tt,[(i(!0),a(h,null,k(ke.value,(t,s)=>(i(),a("div",{key:s,class:"flex items-center justify-between p-3 bg-oled-darker rounded-lg"},[o("div",St,[o("div",wt,[o("span",_t,"+"+r(t.xp_amount)+" XP",1),t.challenge_id?(i(),a("span",Mt,r(t.challenge_id),1)):m("",!0)]),o("div",$t,r(t.reason),1)]),o("div",Lt,[t.solve_time?(i(),a("div",Pt,r(t.solve_time.toFixed(1))+"s ",1)):m("",!0),o("div",Xt,r(ne(t.timestamp)),1)])]))),128))])])):m("",!0),L.value===0?(i(),a("div",Ct,[e[37]||(e[37]=o("div",{class:"text-6xl mb-4"},"ðŸ“Š",-1)),e[38]||(e[38]=o("div",{class:"text-xl font-bold mb-2"},"No XP data yet!",-1)),e[39]||(e[39]=o("div",{class:"text-text-secondary mb-6"}," Complete challenges to start tracking your XP progress. ",-1)),o("button",{class:"oled-button-primary gamepad-focusable",onClick:e[22]||(e[22]=t=>ae(E).push("/challenges"))}," Start a Challenge ")])):m("",!0)],64))]))}}),Ft=Xe(Dt,[["__scopeId","data-v-e287ccb0"]]);export{Ft as default};
