import{d as Ie,u as Pe,r as x,c as U,x as fe,o as Ee,l as Be,b as u,g as a,f as b,q as Te,e as pe,m as J,p as A,F as P,i as E,D as Re,T as Fe,t as f,j as Xe,w as he,n as B,E as qe,k as c,_ as He}from"./index-B7Pz_r6u.js";import{a as Ue}from"./client-H5C7n97n.js";const Ye={class:"skill-tree-fullpage"},ze={key:0,class:"loading-state"},Oe=["viewBox"],Ve={class:"level-labels"},Ge=["x","y"],Ke={class:"edges"},We=["d","stroke","stroke-width","stroke-opacity"],je={class:"nodes"},Ze=["transform","onClick"],Je=["r"],Qe=["r","stroke"],et=["r","fill","stroke","filter"],tt={key:1},st=["d","stroke"],at=["d","stroke"],lt={y:"-12","text-anchor":"middle","font-size":"12"},nt=["fill"],ot=["fill"],rt=["y"],it={key:0,class:"node-details oled-panel"},ut={class:"details-header"},ct={class:"flex items-center gap-3"},dt={class:"text-lg font-bold"},vt={class:"text-text-secondary text-sm mt-3"},ft={class:"mastery-section mt-4"},pt={class:"flex justify-between text-sm mb-2"},ht={class:"text-text-muted"},gt={key:0,class:"text-accent-warning ml-1"},mt={class:"progress-bar"},yt={key:0,class:"mastery-hint mt-3"},kt={key:0,class:"mt-4"},xt={class:"flex flex-wrap gap-2"},bt=["onClick"],_t={key:1,class:"mt-4"},wt={class:"flex flex-wrap gap-2"},Mt=["onClick"],$t={key:3,class:"mt-6"},Dt={class:"force-content"},Ct={key:4,class:"locked-msg mt-6"},At={class:"bottom-right-panel"},Nt={class:"filter-slider"},St={key:0,class:"filter-count"},Lt={key:0,class:"filter-count"},It={key:0,class:"tree-stats"},Pt={class:"stat"},Et={class:"stat-value text-accent-primary"},Bt={class:"stat"},Tt={class:"stat-value text-accent-warning"},Rt={class:"stat"},Ft={class:"stat-value text-accent-secondary"},ge=1500,Xt=20,Q=.2,me=.7,qt=Ie({__name:"SkillTreeView",setup(Ht){const Y=Xe(),ee=Pe(),o=x(null),m=x(0),N=x(!0),d=x({x:0,y:0,width:1600,height:1200}),_=x(!1),w=x("both"),T=x(!1),R=x({x:0,y:0}),D=x(!1),F=x(0),te=x(0);let S=null,X=null;const z={0:"#00ff88",1:"#0088ff",2:"#00ffff",3:"#ff00ff",4:"#ffaa00",5:"#ff4444",6:"#ffffff"},se={mastered:"#a855f7",learning:"#ffaa00",available:"#0088ff",locked:"#333333"},ye={concept:"#a855f7",challenge:"#22c55e"};function C(s,e){if(e)return"#a855f7";if(s<=0)return"#333333";const t=[{pct:0,color:[51,51,51]},{pct:10,color:[127,29,29]},{pct:20,color:[185,28,28]},{pct:30,color:[220,38,38]},{pct:40,color:[234,88,12]},{pct:50,color:[234,179,8]},{pct:60,color:[132,204,22]},{pct:70,color:[59,130,246]},{pct:80,color:[34,197,94]},{pct:90,color:[22,163,74]},{pct:100,color:[34,197,94]}];let n=t[0],r=t[t.length-1];for(let g=0;g<t.length-1;g++)if(s>=t[g].pct&&s<=t[g+1].pct){n=t[g],r=t[g+1];break}const i=r.pct-n.pct,v=i>0?(s-n.pct)/i:0,p=Math.round(n.color[0]+(r.color[0]-n.color[0])*v),h=Math.round(n.color[1]+(r.color[1]-n.color[1])*v),y=Math.round(n.color[2]+(r.color[2]-n.color[2])*v);return`rgb(${p}, ${h}, ${y})`}function ke(s){return s.type==="concept"?"ðŸ“š":"ðŸŽ®"}function xe(s){return s.mastery_percent>0&&s.state!=="mastered"}function ae(s,e,t){if(e<=0)return"";const r=Math.min(e,100)/2/50*180;if(r<=0)return"";const i=-90,v=t==="right"?i+r:i-r,p=i*Math.PI/180,h=v*Math.PI/180,y=s*Math.cos(p),g=s*Math.sin(p),Z=s*Math.cos(h),Se=s*Math.sin(h),Le=r>180?1:0;return`M ${y} ${g} A ${s} ${s} 0 ${Le} ${t==="right"?1:0} ${Z} ${Se}`}function q(s){if(!l.value)return!1;const e=l.value.id;return s.from===e||s.to===e}const k=U(()=>o.value?w.value==="both"?o.value.nodes:o.value.nodes.filter(s=>s.type===w.value.slice(0,-1)):[]),be=U(()=>{if(!o.value)return[];const s=new Set(k.value.map(e=>e.id));return o.value.edges.filter(e=>s.has(e.from)&&s.has(e.to))}),l=U(()=>k.value.length===0?null:k.value[m.value]),L=U(()=>{if(k.value.length===0)return new Map;const s=new Map;return k.value.forEach((e,t)=>{s.has(e.level)||s.set(e.level,[]),s.get(e.level).push(t)}),s.forEach(e=>{e.sort((t,n)=>{const r=k.value[t],i=k.value[n];return r.position.x-i.position.x})}),s});async function _e(){N.value=!0;try{const s=await Ue.get("/api/skill-tree?include=both");o.value=s.data,o.value&&(le(o.value.nodes),I(0))}catch(s){console.error("Failed to load skill tree:",s)}finally{N.value=!1}}fe(w,()=>{o.value&&(le(o.value.nodes),m.value=0)});function le(s){const e=new Map;for(const i of s)e.has(i.level)||e.set(i.level,[]),e.get(i.level).push(i);const t=200,n=180,r=d.value.width/2;for(const[i,v]of e){const p=(v.length-1)*n,h=r-p/2;v.forEach((y,g)=>{y.position={x:h+g*n,y:120+i*t}})}}function I(s){if(!o.value)return;const e=o.value.nodes[s];e&&(d.value.x=e.position.x-d.value.width/2,d.value.y=e.position.y-d.value.height/2)}function M(s){return 35+s.mastery*5}function we(s){if(!o.value)return"";const e=o.value.nodes.find(g=>g.id===s.from),t=o.value.nodes.find(g=>g.id===s.to);if(!e||!t)return"";const n=M(e),r=M(t),i=e.position.x,v=e.position.y+n,p=t.position.x,h=t.position.y-r,y=(v+h)/2;return`M ${i} ${v} C ${i} ${y}, ${p} ${y}, ${p} ${h}`}function Me(s){if(!o.value)return"#333";const e=o.value.nodes.find(t=>t.id===s.to);return e&&se[e.state]||"#333"}function $e(s){s.target.closest(".skill-node")||(T.value=!0,R.value={x:s.clientX,y:s.clientY})}function De(s){if(!T.value)return;const e=s.clientX-R.value.x,t=s.clientY-R.value.y;d.value.x-=e*2,d.value.y-=t*2,R.value={x:s.clientX,y:s.clientY}}function ne(){T.value=!1}function Ce(s){s.preventDefault();const e=s.deltaY>0?1.1:.9;d.value.width*=e,d.value.height*=e}function O(){if(!o.value||!l.value)return;const s=l.value.level;if(s<=0)return;const e=L.value.get(s-1);if(!e||e.length===0)return;const t=l.value.position.x;let n=e[0],r=1/0;for(const i of e){const v=o.value.nodes[i],p=Math.abs(v.position.x-t);p<r&&(r=p,n=i)}m.value=n,I(n)}function V(){if(!o.value||!l.value)return;const s=l.value.level,e=Math.max(...Array.from(L.value.keys()));if(s>=e)return;const t=L.value.get(s+1);if(!t||t.length===0)return;const n=l.value.position.x;let r=t[0],i=1/0;for(const v of t){const p=o.value.nodes[v],h=Math.abs(p.position.x-n);h<i&&(i=h,r=v)}m.value=r,I(r)}function G(){if(!o.value||!l.value)return;const s=l.value.level,e=L.value.get(s);if(!e||e.length<=1)return;const t=e.indexOf(m.value);t>0&&(m.value=e[t-1],I(m.value))}function K(){if(!o.value||!l.value)return;const s=l.value.level,e=L.value.get(s);if(!e||e.length<=1)return;const t=e.indexOf(m.value);t<e.length-1&&(m.value=e[t+1],I(m.value))}function oe(){_.value=!0}function W(){l.value&&l.value.state!=="locked"&&l.value.challenges.starter&&Y.push(`/challenge/${l.value.challenges.starter}`)}function Ae(){l.value&&l.value.challenges.starter&&Y.push(`/challenge/${l.value.challenges.starter}`)}function H(){if(!l.value||l.value.state!=="locked"||!l.value.challenges.starter)return;D.value=!0,te.value=performance.now(),F.value=0;function s(){if(!D.value)return;const e=performance.now()-te.value;if(F.value=Math.min(100,e/ge*100),e>=ge){$(),Ae();return}S=requestAnimationFrame(s)}S=requestAnimationFrame(s)}function $(){D.value=!1,F.value=0,S!==null&&(cancelAnimationFrame(S),S=null)}function j(){_.value?_.value=!1:Y.push("/progress")}function re(s){if(!o.value)return;let e=k.value.findIndex(n=>n.id===s);if(e===-1){w.value="both",qe(()=>{const n=k.value.findIndex(r=>r.id===s);if(n!==-1){m.value=n;const r=k.value[n];d.value.x=r.position.x-d.value.width/2,d.value.y=r.position.y-d.value.height/2,_.value=!0}});return}m.value=e;const t=k.value[e];d.value.x=t.position.x-d.value.width/2,d.value.y=t.position.y-d.value.height/2,_.value=!0}function Ne(s){m.value=s,_.value=!0}const ie=x({});fe(()=>ee.buttons,s=>{if(N.value)return;const e=ie.value;s.DPadUp&&!e.DPadUp&&O(),s.DPadDown&&!e.DPadDown&&V(),s.DPadLeft&&!e.DPadLeft&&G(),s.DPadRight&&!e.DPadRight&&K(),s.A&&!e.A?_.value&&l.value?l.value.state==="locked"&&l.value.challenges.starter?H():W():oe():!s.A&&e.A&&D.value&&$(),s.B&&!e.B&&j(),ie.value={...s}},{deep:!0});function ue(s){if(!N.value)switch(s.key){case"ArrowUp":case"w":case"W":s.preventDefault(),O();break;case"ArrowDown":case"s":case"S":s.preventDefault(),V();break;case"ArrowLeft":case"a":case"A":s.preventDefault(),G();break;case"ArrowRight":case"d":case"D":s.preventDefault(),K();break;case"Enter":case" ":s.preventDefault(),_.value&&l.value?l.value.state==="locked"&&l.value.challenges.starter?D.value||H():W():oe();break;case"Escape":s.preventDefault(),j();break}}function ce(s){(s.key==="Enter"||s.key===" ")&&D.value&&$()}let de=0;function ve(){const{rightStick:s,leftStick:e}=ee,t=e.x,n=e.y,r=Math.sqrt(t*t+n*n);if(r>=me&&de<me){const h=Math.abs(t),y=Math.abs(n);h>y?t>0?K():G():n>0?V():O()}de=r;const i=s.x,v=s.y,p=Math.sqrt(i*i+v*v);if(p>Q){const h=(p-Q)/(1-Q),y=Xt*h*h,g=i/p,Z=v/p;d.value.x+=g*y,d.value.y+=Z*y}X=requestAnimationFrame(ve)}return Ee(()=>{_e(),window.addEventListener("keydown",ue),window.addEventListener("keyup",ce),X=requestAnimationFrame(ve)}),Be(()=>{window.removeEventListener("keydown",ue),window.removeEventListener("keyup",ce),$(),X!==null&&cancelAnimationFrame(X)}),(s,e)=>(c(),u("div",Ye,[a("div",{class:"tree-header"},[a("button",{class:"back-btn",onClick:j},[...e[4]||(e[4]=[a("span",{class:"gamepad-hint-button b"},"B",-1),J(" Back ",-1)])]),e[5]||(e[5]=a("span",{class:"text-2xl font-bold text-accent-primary"},"Skill Tree",-1)),e[6]||(e[6]=a("div",{class:"header-spacer"},null,-1))]),N.value?(c(),u("div",ze,[...e[7]||(e[7]=[a("div",{class:"text-accent-primary animate-pulse text-xl"},"Loading skill tree...",-1)])])):o.value?(c(),u("svg",{key:1,class:A(["skill-tree-svg",{dragging:T.value}]),viewBox:`${d.value.x} ${d.value.y} ${d.value.width} ${d.value.height}`,preserveAspectRatio:"xMidYMid meet",onMousedown:$e,onMousemove:De,onMouseup:ne,onMouseleave:ne,onWheel:Ce},[e[9]||(e[9]=pe('<defs data-v-3b36770e><pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse" data-v-3b36770e><path d="M 50 0 L 0 0 0 50" fill="none" stroke="#1a1a1a" stroke-width="0.5" data-v-3b36770e></path></pattern><filter id="glow" x="-50%" y="-50%" width="200%" height="200%" data-v-3b36770e><feGaussianBlur stdDeviation="4" result="coloredBlur" data-v-3b36770e></feGaussianBlur><feMerge data-v-3b36770e><feMergeNode in="coloredBlur" data-v-3b36770e></feMergeNode><feMergeNode in="SourceGraphic" data-v-3b36770e></feMergeNode></feMerge></filter></defs><rect x="-5000" y="-5000" width="10000" height="10000" fill="url(#grid)" data-v-3b36770e></rect>',2)),a("g",Ve,[(c(),u(P,null,E(7,t=>a("text",{key:`level-${t-1}`,x:d.value.x+30,y:120+(t-1)*200,fill:"#444","font-size":"16","font-weight":"bold"}," Level "+f(t-1),9,Ge)),64))]),a("g",Ke,[(c(!0),u(P,null,E(be.value,(t,n)=>(c(),u("path",{key:`edge-${n}`,d:we(t),stroke:q(t)?"#ffffff":Me(t),"stroke-width":q(t)?4:2,fill:"none","stroke-opacity":l.value?q(t)?.9:.15:.4,class:A({"edge-highlighted":q(t)})},null,10,We))),128))]),a("g",je,[(c(!0),u(P,null,E(k.value,(t,n)=>(c(),u("g",{key:t.id,transform:`translate(${t.position.x}, ${t.position.y})`,class:A(["skill-node",{[t.state]:!0,[t.type]:!0,selected:n===m.value}]),onClick:he(r=>Ne(n),["stop"])},[n===m.value?(c(),u("circle",{key:0,r:M(t)+10,fill:"none",stroke:"#ffffff","stroke-width":"2","stroke-dasharray":"6 4"},[...e[8]||(e[8]=[a("animateTransform",{attributeName:"transform",type:"rotate",from:"0",to:"360",dur:"8s",repeatCount:"indefinite"},null,-1)])],8,Je)):b("",!0),a("circle",{r:M(t)+3,fill:"none",stroke:ye[t.type],"stroke-width":"2","stroke-opacity":"0.5"},null,8,Qe),a("circle",{r:M(t),fill:t.state==="locked"?"#111":"#000",stroke:C(t.mastery_percent,t.state==="mastered"),"stroke-width":"4",filter:t.state==="mastered"?"url(#glow)":""},null,8,et),xe(t)?(c(),u("g",tt,[a("path",{d:ae(M(t)-6,t.mastery_percent,"left"),fill:"none",stroke:C(t.mastery_percent,!1),"stroke-width":"5","stroke-linecap":"round"},null,8,st),a("path",{d:ae(M(t)-6,t.mastery_percent,"right"),fill:"none",stroke:C(t.mastery_percent,!1),"stroke-width":"5","stroke-linecap":"round"},null,8,at)])):b("",!0),a("text",lt,f(ke(t)),1),a("text",{y:"4","text-anchor":"middle",fill:C(t.mastery_percent,t.state==="mastered"),"font-size":"14","font-weight":"bold"},f(t.mastery_percent>0?Math.round(t.mastery_percent)+"%":""),9,nt),a("text",{y:"18","text-anchor":"middle",fill:z[t.level],"font-size":"9","font-weight":"bold"}," L"+f(t.level),9,ot),a("text",{y:M(t)+20,"text-anchor":"middle",fill:"#aaa","font-size":"13","font-weight":"500"},f(t.name.length>16?t.name.substring(0,14)+"...":t.name),9,rt)],10,Ze))),128))])],42,Oe)):b("",!0),Te(Fe,{name:"slide"},{default:Re(()=>[_.value&&l.value?(c(),u("div",it,[a("div",ut,[a("div",ct,[a("div",{class:"level-badge",style:B({borderColor:z[l.value.level],color:z[l.value.level]})}," L"+f(l.value.level),5),a("div",null,[a("h3",dt,f(l.value.name),1),a("div",{class:"text-sm capitalize",style:B({color:se[l.value.state]})},f(l.value.state),5)])]),a("button",{class:"close-btn",onClick:e[0]||(e[0]=t=>_.value=!1)},"Ã—")]),a("p",vt,f(l.value.description),1),a("div",ft,[a("div",pt,[a("span",ht,f(l.value.type==="challenge"?"Retention":"Mastery Progress"),1),a("span",{style:B({color:C(l.value.mastery_percent,l.value.state==="mastered")})},[J(f(Math.round(l.value.mastery_percent))+"% ",1),l.value.needs_review?(c(),u("span",gt,"âš ï¸")):b("",!0)],4)]),a("div",mt,[a("div",{class:"progress-fill",style:B({width:`${l.value.mastery_percent}%`,background:C(l.value.mastery_percent,l.value.state==="mastered")})},null,4)]),l.value.mastery_hint?(c(),u("div",yt,[e[10]||(e[10]=a("span",{class:"hint-icon"},"ðŸ’¡",-1)),a("span",null,f(l.value.mastery_hint),1)])):b("",!0)]),l.value.prerequisites.length>0?(c(),u("div",kt,[e[11]||(e[11]=a("div",{class:"text-sm text-text-muted mb-2"},"Prerequisites",-1)),a("div",xt,[(c(!0),u(P,null,E(l.value.prerequisites,t=>(c(),u("button",{key:t,class:"prereq-tag clickable",onClick:n=>re(t)},f(t),9,bt))),128))])])):b("",!0),l.value.unlocks.length>0?(c(),u("div",_t,[e[12]||(e[12]=a("div",{class:"text-sm text-text-muted mb-2"},"Unlocks",-1)),a("div",wt,[(c(!0),u(P,null,E(l.value.unlocks,t=>(c(),u("button",{key:t,class:"unlock-tag clickable",onClick:n=>re(t)},f(t),9,Mt))),128))])])):b("",!0),l.value.state!=="locked"&&l.value.challenges.starter?(c(),u("button",{key:2,class:"start-btn mt-6",onClick:W},[...e[13]||(e[13]=[a("span",{class:"gamepad-hint-button a"},"A",-1),J(" Start Challenge ",-1)])])):l.value.state==="locked"&&l.value.challenges.starter?(c(),u("div",$t,[a("button",{class:"force-start-btn",onMousedown:H,onMouseup:$,onMouseleave:$,onTouchstart:he(H,["prevent"]),onTouchend:$,onTouchcancel:$},[a("div",{class:"force-progress",style:B({width:`${F.value}%`})},null,4),a("span",Dt,[e[14]||(e[14]=a("span",{class:"gamepad-hint-button a"},"A",-1)),a("span",null,f(D.value?"Hold...":"Try Anyway"),1)])],32),e[15]||(e[15]=a("div",{class:"force-hint"}," Not recommended yet â€” but you can give it a go! ",-1))])):l.value.state==="locked"?(c(),u("div",Ct," Complete prerequisites to unlock ")):b("",!0)])):b("",!0)]),_:1}),e[24]||(e[24]=pe('<div class="controls-hint" data-v-3b36770e><div class="hint-item" data-v-3b36770e><span class="hint-key" data-v-3b36770e>D-Pad</span><span data-v-3b36770e>Navigate</span></div><div class="hint-item" data-v-3b36770e><span class="gamepad-hint-button a" data-v-3b36770e>A</span><span data-v-3b36770e>Select</span></div><div class="hint-item" data-v-3b36770e><span class="gamepad-hint-button b" data-v-3b36770e>B</span><span data-v-3b36770e>Back</span></div><div class="hint-item" data-v-3b36770e><span class="hint-key" data-v-3b36770e>Drag</span><span data-v-3b36770e>Pan</span></div></div>',1)),a("div",At,[a("div",Nt,[a("button",{class:A(["filter-btn",{active:w.value==="concepts"}]),onClick:e[1]||(e[1]=t=>w.value="concepts")},[e[16]||(e[16]=a("span",{class:"filter-icon"},"ðŸ“š",-1)),e[17]||(e[17]=a("span",null,"Concepts",-1)),o.value?(c(),u("span",St,f(o.value.summary.concepts),1)):b("",!0)],2),a("button",{class:A(["filter-btn",{active:w.value==="challenges"}]),onClick:e[2]||(e[2]=t=>w.value="challenges")},[e[18]||(e[18]=a("span",{class:"filter-icon"},"ðŸŽ®",-1)),e[19]||(e[19]=a("span",null,"Challenges",-1)),o.value?(c(),u("span",Lt,f(o.value.summary.challenges),1)):b("",!0)],2),a("button",{class:A(["filter-btn both",{active:w.value==="both"}]),onClick:e[3]||(e[3]=t=>w.value="both")},[...e[20]||(e[20]=[a("span",null,"Both",-1)])],2)]),o.value?(c(),u("div",It,[a("div",Pt,[a("span",Et,f(o.value.summary.mastered),1),e[21]||(e[21]=a("span",{class:"stat-label"},"Mastered",-1))]),a("div",Bt,[a("span",Tt,f(o.value.summary.learning),1),e[22]||(e[22]=a("span",{class:"stat-label"},"Learning",-1))]),a("div",Rt,[a("span",Ft,f(o.value.summary.available),1),e[23]||(e[23]=a("span",{class:"stat-label"},"Available",-1))])])):b("",!0)])]))}}),Ot=He(qt,[["__scopeId","data-v-3b36770e"]]);export{Ot as default};
