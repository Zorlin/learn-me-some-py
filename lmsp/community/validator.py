"""
Community Content Validator

Validates community-created content before loading.

Ensures:
- Valid JSON structure
- Required fields present
- Content meets quality standards
- Compatibility with LMSP version

Self-teaching note:
This file demonstrates:
- Validation patterns (Level 5+)
- Error handling and reporting (Level 3-4)
- Type checking (Level 5: type hints)
"""

from dataclasses import dataclass
from typing import List, Dict, Any, Optional
from enum import Enum


class ValidationSeverity(Enum):
    \"\"\"Severity levels for validation issues.\"\"\"

    INFO = \"info\"
    WARNING = \"warning\"
    ERROR = \"error\"


@dataclass\nclass ValidationIssue:\n    \"\"\"A single validation issue.\"\"\"\n    \n    field: str\n    message: str\n    severity: ValidationSeverity = ValidationSeverity.ERROR\n    suggestion: Optional[str] = None\n\n\n@dataclass\nclass ValidationResult:\n    \"\"\"Result of validating content.\"\"\"\n    \n    is_valid: bool\n    issues: List[ValidationIssue] = None\n    \n    def __post_init__(self):\n        if self.issues is None:\n            self.issues = []\n    \n    @property\n    def errors(self) -> List[ValidationIssue]:\n        \"\"\"Get all error-level issues.\"\"\"\n        return [i for i in self.issues if i.severity == ValidationSeverity.ERROR]\n    \n    @property\n    def warnings(self) -> List[ValidationIssue]:\n        \"\"\"Get all warning-level issues.\"\"\"\n        return [i for i in self.issues if i.severity == ValidationSeverity.WARNING]\n    \n    @property\n    def info(self) -> List[ValidationIssue]:\n        \"\"\"Get all info-level issues.\"\"\"\n        return [i for i in self.issues if i.severity == ValidationSeverity.INFO]\n\n\nclass ContentValidator:\n    \"\"\"Validates community content.\"\"\"\n    \n    # Required fields by content type\n    CONCEPT_REQUIRED = {\"id\", \"name\", \"description\", \"examples\", \"test_cases\"}\n    CHALLENGE_REQUIRED = {\"id\", \"title\", \"description\", \"instructions\", \"solution\", \"test_code\"}\n    PACK_REQUIRED = {\"id\", \"title\", \"description\", \"concepts\", \"challenges\"}\n    \n    def validate_concept(self, data: Dict[str, Any]) -> ValidationResult:\n        \"\"\"Validate a concept definition.\n        \n        Args:\n            data: Concept data as dictionary\n            \n        Returns:\n            ValidationResult with issues if any\n        \"\"\"\n        issues = []\n        \n        # Check required fields\n        for field in self.CONCEPT_REQUIRED:\n            if field not in data:\n                issues.append(ValidationIssue(\n                    field=field,\n                    message=f\"Required field '{field}' is missing\",\n                    severity=ValidationSeverity.ERROR,\n                    suggestion=f\"Add a {field} field to your concept\"\n                ))\n        \n        # Validate structure\n        if \"examples\" in data and not isinstance(data[\"examples\"], list):\n            issues.append(ValidationIssue(\n                field=\"examples\",\n                message=\"examples must be a list\",\n                severity=ValidationSeverity.ERROR\n            ))\n        \n        if \"test_cases\" in data and not isinstance(data[\"test_cases\"], list):\n            issues.append(ValidationIssue(\n                field=\"test_cases\",\n                message=\"test_cases must be a list\",\n                severity=ValidationSeverity.ERROR\n            ))\n        \n        # Check for empty values\n        for field in [\"name\", \"description\"]:\n            if field in data and not data[field]:\n                issues.append(ValidationIssue(\n                    field=field,\n                    message=f\"{field} cannot be empty\",\n                    severity=ValidationSeverity.ERROR\n                ))\n        \n        return ValidationResult(\n            is_valid=len([i for i in issues if i.severity == ValidationSeverity.ERROR]) == 0,\n            issues=issues\n        )\n    \n    def validate_challenge(self, data: Dict[str, Any]) -> ValidationResult:\n        \"\"\"Validate a challenge definition.\n        \n        Args:\n            data: Challenge data as dictionary\n            \n        Returns:\n            ValidationResult with issues if any\n        \"\"\"\n        issues = []\n        \n        # Check required fields\n        for field in self.CHALLENGE_REQUIRED:\n            if field not in data:\n                issues.append(ValidationIssue(\n                    field=field,\n                    message=f\"Required field '{field}' is missing\",\n                    severity=ValidationSeverity.ERROR,\n                    suggestion=f\"Add a {field} field to your challenge\"\n                ))\n        \n        # Validate structure\n        if \"difficulty\" in data:\n            if not isinstance(data[\"difficulty\"], int) or not (1 <= data[\"difficulty\"] <= 5):\n                issues.append(ValidationIssue(\n                    field=\"difficulty\",\n                    message=\"difficulty must be an integer between 1 and 5\",\n                    severity=ValidationSeverity.ERROR\n                ))\n        \n        if \"concepts\" in data and not isinstance(data[\"concepts\"], list):\n            issues.append(ValidationIssue(\n                field=\"concepts\",\n                message=\"concepts must be a list\",\n                severity=ValidationSeverity.ERROR\n            ))\n        \n        if \"hints\" in data and not isinstance(data[\"hints\"], list):\n            issues.append(ValidationIssue(\n                field=\"hints\",\n                message=\"hints must be a list\",\n                severity=ValidationSeverity.WARNING\n            ))\n        \n        # Check solution validity\n        if \"solution\" in data and \"test_code\" in data:\n            # Note: We can't actually run the test without more context\n            # Just check that both exist\n            if not data[\"solution\"]:\n                issues.append(ValidationIssue(\n                    field=\"solution\",\n                    message=\"solution code cannot be empty\",\n                    severity=ValidationSeverity.ERROR\n                ))\n        \n        return ValidationResult(\n            is_valid=len([i for i in issues if i.severity == ValidationSeverity.ERROR]) == 0,\n            issues=issues\n        )\n    \n    def validate_pack(self, data: Dict[str, Any]) -> ValidationResult:\n        \"\"\"Validate a content pack definition.\n        \n        Args:\n            data: Pack data as dictionary\n            \n        Returns:\n            ValidationResult with issues if any\n        \"\"\"\n        issues = []\n        \n        # Check required fields\n        for field in self.PACK_REQUIRED:\n            if field not in data:\n                issues.append(ValidationIssue(\n                    field=field,\n                    message=f\"Required field '{field}' is missing\",\n                    severity=ValidationSeverity.ERROR,\n                    suggestion=f\"Add a {field} field to your pack\"\n                ))\n        \n        # Validate structure\n        for field in [\"concepts\", \"challenges\"]:\n            if field in data and not isinstance(data[field], list):\n                issues.append(ValidationIssue(\n                    field=field,\n                    message=f\"{field} must be a list\",\n                    severity=ValidationSeverity.ERROR\n                ))\n        \n        # Check learner level\n        if \"learner_level\" in data:\n            valid_levels = {\"beginner\", \"intermediate\", \"advanced\"}\n            if data[\"learner_level\"] not in valid_levels:\n                issues.append(ValidationIssue(\n                    field=\"learner_level\",\n                    message=f\"learner_level must be one of: {', '.join(valid_levels)}\",\n                    severity=ValidationSeverity.ERROR\n                ))\n        \n        return ValidationResult(\n            is_valid=len([i for i in issues if i.severity == ValidationSeverity.ERROR]) == 0,\n            issues=issues\n        )\n    \n    def get_validation_report(self, result: ValidationResult) -> str:\n        \"\"\"Generate a human-readable validation report.\n        \n        Args:\n            result: ValidationResult to report\n            \n        Returns:\n            Formatted report string\n        \"\"\"\n        lines = []\n        \n        if result.is_valid:\n            lines.append(\"‚úÖ Content validation passed!\")\n        else:\n            lines.append(\"‚ùå Content validation failed\")\n        \n        if result.errors:\n            lines.append(f\"\\nErrors ({len(result.errors)}):\")\n            for issue in result.errors:\n                lines.append(f\"  - {issue.field}: {issue.message}\")\n                if issue.suggestion:\n                    lines.append(f\"    üí° {issue.suggestion}\")\n        \n        if result.warnings:\n            lines.append(f\"\\nWarnings ({len(result.warnings)}):\")\n            for issue in result.warnings:\n                lines.append(f\"  - {issue.field}: {issue.message}\")\n        \n        return \"\\n\".join(lines)\n\n\n# Self-teaching note:\n#\n# This file demonstrates:\n# - Validation patterns (Level 5+)\n# - Dataclasses for structured results (Level 5)\n# - Enum for severity levels (Level 4)\n# - Error reporting and suggestions (Level 6)\n# - Type checking and validation (Level 5+)\n#\n# Validation is important for:\n# 1. Catching errors early\n# 2. Providing helpful feedback\n# 3. Preventing invalid data from breaking the system\n# 4. Guiding content creators\n# 5. Maintaining quality standards\n#\n# Prerequisites:\n# - Level 3: Functions, error handling\n# - Level 4: Collections, enums\n# - Level 5: Dataclasses, type hints\n# - Level 6: Design patterns, validation\n"}}]

</invoke>