# LMSP Troubleshooting Guide\n\n**Solutions to common problems and how to debug them.**\n\n## Installation Issues\n\n### Problem: `ModuleNotFoundError: No module named 'pygame'` or similar\n\n**Cause**: Dependencies not installed\n\n**Solution**:\n```bash\n# Install all dependencies\npip install -e \".[dev]\"\n\n# Or just install the base package\npip install -e .\n```\n\n### Problem: `ERROR: Could not find a version that satisfies the requirement`\n\n**Cause**: Python version incompatibility or broken requirements\n\n**Solution**:\n```bash\n# Check Python version (needs 3.10+)\npython --version\n\n# Create fresh virtual environment\npython -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Reinstall\npip install -e .\n```\n\n### Problem: Permission error when installing\n\n**Cause**: Missing permissions in the Python environment\n\n**Solution**:\n```bash\n# Use user flag\npip install --user -e .\n\n# Or use virtual environment (recommended)\npython -m venv venv\nsource venv/bin/activate\npip install -e .\n```\n\n---\n\n## Concept & Challenge Loading Issues\n\n### Problem: `FileNotFoundError: concepts/ directory not found`\n\n**Cause**: Working from wrong directory\n\n**Solution**:\n```bash\n# Must run from project root\ncd /mnt/castle/garage/learn-me-some-py\npython -m lmsp\n```\n\n### Problem: `ValueError: Concept graph contains cycles!`\n\n**Cause**: Circular prerequisite dependency\n\nExample: A requires B, B requires C, C requires A\n\n**Solution**:\n1. Identify the cycle:\n   ```python\n   from lmsp.python.concepts import ConceptDAG, ConceptLoader\n   loader = ConceptLoader()\n   concepts = loader.load_all()\n   dag = ConceptDAG(concepts)\n   print(f\"Has cycle: {dag.has_cycle()}\")\n   ```\n\n2. Fix the prerequisite declarations in TOML files\n3. Verify by running the above check again\n\n### Problem: `KeyError: 'concept_id' not found in TOML`\n\n**Cause**: Missing required fields in concept TOML file\n\n**Solution**:\nCheck concept file has required structure:\n```toml\n[concept]\nid = \"unique_id\"\nname = \"Display Name\"\nlevel = 2\nprerequisites = []\nunlocks = []\n\n[description]\nbrief = \"Short description\"\ndetailed = \"Long description\"\n```\n\n### Problem: Challenge not appearing in game\n\n**Cause**: \n- Missing prerequisites\n- Challenge file malformed\n- Not matching player's current level\n\n**Solution**:\n```python\nfrom lmsp.python.challenges import ChallengeLoader\nfrom lmsp.python.concepts import ConceptDAG, ConceptLoader\n\n# Load and validate\nloader = ChallengeLoader()\nchallenges = loader.load_all()\n\n# Check specific challenge\nchallenge = [c for c in challenges if c.id == \"your_challenge\"][0]\nprint(f\"Prerequisites: {challenge.prerequisites}\")\nprint(f\"Level: {challenge.level}\")\n\n# Verify prerequisites are loadable\nconc_loader = ConceptLoader()\nconcepts = conc_loader.load_all()\nfor prereq in challenge.prerequisites:\n    if prereq not in concepts:\n        print(f\"ERROR: Missing prerequisite concept: {prereq}\")\n```\n\n---\n\n## Code Validation Issues\n\n### Problem: `TimeoutError: Code execution timed out`\n\n**Cause**: Player code is in infinite loop or very slow\n\n**Solution**:\n```python\nfrom lmsp.python.validator import Validator\n\n# Increase timeout for complex operations\nvalidator = Validator(timeout=10.0)  # 10 seconds\n\n# Or check code for obvious issues\nif \"while True\" in player_code and \"break\" not in player_code:\n    print(\"Warning: Infinite loop detected\")\n```\n\n### Problem: `ValidationError: Security violation - function not in whitelist`\n\n**Cause**: Player code uses restricted functions (import, eval, etc)\n\n**Solution**: This is intentional for security. The error message should guide the player to use allowed functions.\n\n**Debugging**:\n```python\nfrom lmsp.python.validator import Validator\n\nvalidator = Validator(allow_imports=False)  # Restrict imports\nresult = validator.validate(code, test_cases)\n\nif result.security_error:\n    print(f\"Security violation: {result.security_error}\")\n```\n\n### Problem: `MemoryError: Exceeded 512 MB memory limit`\n\n**Cause**: Player code allocates huge data structures\n\n**Solution**:\n```python\n# Increase memory limit if needed\nvalidator = Validator(max_memory_mb=1024)  # 1 GB\n```\n\n### Problem: Test case returns wrong type\n\n**Cause**: Function returns string instead of int, etc.\n\n**Example**:\n```python\n# Player code\ndef add(a, b):\n    return str(a + b)  # Returns string!\n\n# Test expects int\n# Expected: 5, Got: \"5\"\n```\n\n**Solution**:\n- Validator shows the type mismatch\n- Player needs to fix return type\n\n---\n\n## Renderer Issues\n\n### Problem: Text output looks garbled or has wrong colors\n\n**Cause**: Terminal doesn't support ANSI colors or Rich features\n\n**Solution**:\n```python\n# Use MinimalRenderer instead of RichRenderer\nfrom lmsp.game.renderer import MinimalRenderer\n\nrenderer = MinimalRenderer()\nrenderer.render_state(game_state)  # Plain text output\n```\n\n### Problem: Terminal size too small for display\n\n**Cause**: Window is too narrow or short\n\n**Solution**:\n```bash\n# Resize terminal to at least 80x24\n# Or use MinimalRenderer which wraps better\n```\n\n### Problem: Colors are inverted or wrong\n\n**Cause**: Terminal color scheme conflicts\n\n**Solution**:\n```python\nfrom lmsp.game.renderer import RichRenderer\n\n# Force specific theme\nrenderer = RichRenderer(force_terminal=True)\n```\n\n---\n\n## Game State Issues\n\n### Problem: XP/Level not updating after completion\n\n**Cause**: State not being saved, or session not committing completion\n\n**Solution**:\n```python\nfrom lmsp.game.state import GameState\n\nstate = GameState(player_id=\"alice\")\nprint(f\"Before: XP={state.current_xp}\")\n\nstate.add_xp(50)\nprint(f\"After: XP={state.current_xp}\")\n\n# Verify level calculation\nstats = state.get_statistics()\nprint(f\"Level: {stats['level']}\")\n```\n\n### Problem: Concepts won't unlock\n\n**Cause**: Not actually completing the challenge, or requirement mismatch\n\n**Solution**:\n```python\nstate = GameState(player_id=\"alice\")\nprint(f\"Unlocked: {state.unlocked_concepts}\")\n\n# Manually unlock for testing\nstate.unlock_concept(\"lists\")\nprint(f\"After unlock: {state.unlocked_concepts}\")\n```\n\n### Problem: Challenge says prerequisites not met\n\n**Cause**: Player hasn't unlocked required concepts\n\n**Solution**:\n```python\nfrom lmsp.python.challenges import Challenge\n\nchallenge = load_challenge(\"lists_iteration\")\nprint(f\"Prerequisites: {challenge.prerequisites}\")\n\n# Check what player has\nplayer_concepts = state.unlocked_concepts\nprint(f\"Player has: {player_concepts}\")\n\n# Find missing\nmissing = set(challenge.prerequisites) - player_concepts\nif missing:\n    print(f\"Missing: {missing}\")\n```\n\n---\n\n## Adaptive Engine Issues\n\n### Problem: Same challenge keeps getting recommended\n\n**Cause**: Engine stuck in recommendation loop\n\n**Solution**:\n```python\nfrom lmsp.adaptive.engine import AdaptiveEngine\n\nengine = AdaptiveEngine()\n\n# Record completion to move on\nengine.record_completion(\n    profile=learner,\n    challenge_id=\"current_challenge\",\n    passed=True,\n    time_seconds=120,\n    attempts=2\n)\n\n# Check scheduler\nschedule = engine.get_review_schedule(learner)\nfor concept, next_time in schedule.items():\n    print(f\"{concept}: next review {next_time}\")\n```\n\n### Problem: Hints aren't helpful\n\n**Cause**: Hint system not integrated with challenge, or wrong hint level\n\n**Solution**:\n```python\nfrom lmsp.adaptive.engine import AdaptiveEngine\n\nengine = AdaptiveEngine()\n\n# Get adaptive hints for player's current level\nhints = engine.get_adaptive_hints(\n    profile=learner,\n    challenge=challenge,\n    attempt_count=3  # After 3 failed attempts\n)\n\nfor hint in hints:\n    print(f\"  - {hint}\")\n```\n\n---\n\n## Input System Issues\n\n### Problem: Gamepad not detected\n\n**Cause**: \n- Gamepad not plugged in\n- Pygame not initialized\n- Wrong controller type\n\n**Solution**:\n```python\nimport pygame\nfrom lmsp.input.gamepad import GamepadManager\n\npygame.init()\nmanager = GamepadManager()\ngamepads = manager.detect_gamepads()\n\nif gamepads:\n    print(f\"Found {len(gamepads)} gamepad(s)\")\n    for gp in gamepads:\n        print(f\"  - {gp.name}\")\nelse:\n    print(\"No gamepads found. Check connection.\")\n```\n\n### Problem: Gamepad buttons not responding\n\n**Cause**: Button mapping wrong, or event loop not processing\n\n**Solution**:\n```python\nfrom lmsp.input.gamepad import Gamepad\n\ngamepad = Gamepad()\nif gamepad.initialize():\n    # Test polling\n    for _ in range(10):\n        gamepad.poll()\n        action = gamepad.get_easy_mode_action()\n        if action:\n            print(f\"Action: {action}\")\n```\n\n### Problem: Keyboard input not working\n\n**Cause**: Input device not recognized, or not in focus\n\n**Solution**:\n```bash\n# Make sure terminal window has focus\n# Try typing something - you should see it appear\n```\n\n---\n\n## Emotional Input Issues\n\n### Problem: Emotional tracking shows all zeros\n\n**Cause**: Input device not providing trigger values\n\n**Solution**:\n```python\nfrom lmsp.input.emotional import EmotionalInput\n\nemotional = EmotionalInput()\n\n# Test recording\nemotional.log_engagement(\n    challenge_id=\"test\",\n    rt_value=0.8,  # Right trigger\n    lt_value=0.0,  # Left trigger\n)\n\n# Check profile\nprofile = emotional.get_engagement_profile(\"test\")\nprint(f\"Joy: {profile['joy']}\")\nprint(f\"Frustration: {profile['frustration']}\")\n```\n\n---\n\n## Testing Issues\n\n### Problem: Tests fail with `import` errors\n\n**Cause**: Package not installed, or import path wrong\n\n**Solution**:\n```bash\n# Reinstall in development mode\npip install -e .\n\n# Run from project root\ncd /mnt/castle/garage/learn-me-some-py\npytest tests/\n```\n\n### Problem: `assert` statement fails with unclear message\n\n**Cause**: Test assumption wrong\n\n**Solution**:\n```bash\n# Run with verbose output\npytest tests/test_concepts.py -vv\n\n# See exactly which assertion failed and why\n```\n\n### Problem: Tests hang or timeout\n\n**Cause**: Infinite loop or blocking operation in code\n\n**Solution**:\n```bash\n# Run with timeout\npytest --timeout=10 tests/\n\n# Add print statements to debug\nprint(\"DEBUG: Entering function\")\nprint(\"DEBUG: Loop iteration 1\")\n# etc.\n```\n\n---\n\n## Performance Issues\n\n### Problem: Game is slow or sluggish\n\n**Cause**:\n- Too many concepts loaded\n- Validator not using caching\n- Renderer doing too much work\n\n**Solution**:\n```python\n# Use profiler to find bottleneck\nimport cProfile\nimport pstats\n\nprof = cProfile.Profile()\nprof.enable()\n\n# Run your code\nstate = GameState()\nstate.add_xp(1000)\n\nprof.disable()\nstats = pstats.Stats(prof)\nstats.sort_stats('cumulative')\nstats.print_stats(10)  # Top 10 slowest\n```\n\n### Problem: Memory usage keeps growing\n\n**Cause**: Memory leak, unreleased resources\n\n**Solution**:\n```python\nimport tracemalloc\n\ntracemalloc.start()\n\n# Run code\nfor i in range(1000):\n    concept = load_concept(f\"concept_{i}\")\n\ncurrent, peak = tracemalloc.get_traced_memory()\nprint(f\"Current: {current / 1024 / 1024:.1f} MB\")\nprint(f\"Peak: {peak / 1024 / 1024:.1f} MB\")\n```\n\n---\n\n## Advanced Debugging\n\n### Enable Debug Logging\n\n```python\nimport logging\n\nlogging.basicConfig(level=logging.DEBUG)\nlogger = logging.getLogger(__name__)\n\n# Now debug messages appear\nlogger.debug(\"Loading challenge...\")\nlogger.info(\"Challenge loaded successfully\")\nlogger.warning(\"Unusual condition detected\")\nlogger.error(\"Operation failed\")\n```\n\n### Inspect Object State\n\n```python\n# Print all attributes of an object\nimport pprint\n\nstate = GameState()\npprint.pprint(vars(state))\n\n# Or use __dict__\nfor key, value in state.__dict__.items():\n    print(f\"{key}: {value}\")\n```\n\n### Interactive Debugging\n\n```python\n# Add breakpoint\nimport pdb\n\ndef my_function():\n    x = 10\n    pdb.set_trace()  # Pause here\n    y = x + 5\n    return y\n\nresult = my_function()\n# Now you're in interactive debugger - type help() for commands\n```\n\n### Check Python Environment\n\n```bash\n# Show Python info\npython --version\npython -c \"import sys; print(sys.executable)\"\n\n# List installed packages\npip list\n\n# Show package versions used\npip show pygame networkx rich\n```\n\n---\n\n## Getting Help\n\n### Check Documentation\n- `/docs/` - Main documentation\n- `/docs/00-API-REFERENCE.md` - Complete API with examples\n- `/docs/01-IMPLEMENTATION-NOTES.md` - Design decisions and patterns\n\n### Check Tests\nTests are examples of how to use the API:\n```bash\n# Find tests for a module\ngrep -r \"def test_\" tests/ | grep validator\n\n# Run a specific test\npytest tests/test_validator.py::test_name -vv\n```\n\n### Check Code Comments\nEach file has `# Self-teaching note:` at the end explaining what it demonstrates:\n```python\n# See end of lmsp/python/validator.py for what it teaches\n```\n\n### Minimal Reproducible Example\n\nWhen reporting a bug, create the smallest code that reproduces it:\n\n```python\nfrom lmsp.python.validator import Validator\n\n# Minimal example\nvalidator = Validator()\nresult = validator.validate(\n    \"def add(a, b): return a + b\",\n    [{\"input\": [1, 2], \"expected\": 3}],\n    \"add\"\n)\n\nif not result.success:\n    print(f\"BUG: {result.error}\")\n```\n\nInclude:\n1. What you expected\n2. What actually happened\n3. Steps to reproduce\n4. Python version and OS\n\n---\n\n## Checklist for Debugging\n\nWhen something breaks, go through this checklist:\n\n- [ ] Is the project root directory correct?\n- [ ] Are all dependencies installed? (`pip install -e .`)\n- [ ] Are you using the right Python version? (`python --version`)\n- [ ] Does a minimal example reproduce the issue?\n- [ ] Have you checked the logs? (Enable DEBUG logging)\n- [ ] Have you restarted the program?\n- [ ] Have you restarted Python/the terminal?\n- [ ] Have you tried reinstalling? (`pip install -e . --force-reinstall`)\n- [ ] Did you check the relevant test file for usage examples?\n- [ ] Have you read the self-teaching note at the end of the file?\n\n---\n\n*If you're still stuck, check the issues/discussions or the documentation more carefully!*\n"